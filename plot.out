Linux system detected with GPU enabled.
Resuming process from previous progress:
{
    "rna": {
        "preprocessing": false,
        "cell_type_cluster": false,
        "dimensionality_reduction": false,
        "sample_distance_calculation": false,
        "trajectory_analysis": false,
        "trajectory_dge": false,
        "cluster_dge": false,
        "visualization": false
    },
    "atac": {
        "preprocessing": false,
        "cell_type_cluster": false,
        "dimensionality_reduction": false,
        "sample_distance_calculation": false,
        "trajectory_analysis": false,
        "trajectory_dge": false,
        "cluster_dge": false,
        "visualization": false
    },
    "multiomics": {
        "glue_integration": true,
        "glue_preprocessing": true,
        "glue_training": true,
        "glue_gene_activity": true,
        "glue_cell_types": true,
        "glue_visualization": true,
        "integration_preprocessing": true,
        "dimensionality_reduction": true,
        "embedding_visualization": true,
        "optimal_resolution": true
    },
    "system_info": {
        "platform": "Linux",
        "python_version": "3.10.18 | packaged by conda-forge | (main, Jun  4 2025, 14:45:41) [GCC 13.3.0]",
        "use_gpu": true,
        "linux_system": true
    }
}

============================================================
RUNNING MULTIOMICS PIPELINE
============================================================
Starting multi-modal pipeline with output directory: /dcs07/hongkai/data/harry/result/multi_omics_unpaired/multiomics
Initial status flags: {'glue_integration': True, 'glue_preprocessing': True, 'glue_training': True, 'glue_gene_activity': True, 'glue_cell_types': True, 'glue_visualization': True, 'integration_preprocessing': True, 'dimensionality_reduction': True, 'embedding_visualization': True, 'optimal_resolution': True}
Loaded preprocessed data from: /dcs07/hongkai/data/harry/result/multi_omics_unpaired/multiomics/preprocess/adata_sample.h5ad
Loaded dimensionality reduction data from existing files
Step 5: Finding optimal cell resolution for both expression and proportion...
GPU Memory: 47.70 GB
GPU Memory Available: 0.00 GB

  Running optimization for EXPRESSION...
  ✓ Expression optimization completed

  Running optimization for PROPORTION...
  ✓ Proportion optimization completed

  Updating pseudobulk with optimal embeddings...

======================================================================
Replacing Dimension Reduction with Optimal Results
======================================================================

[Replace DR] Configuration:
  - Optimization target: RNA

[Replace DR] File paths:
  - Optimal expression: /dcs07/hongkai/data/harry/result/multi_omics_unpaired/multiomics/resolution_optimization_expression/Integration_optimization_rna_expression/summary/optimal_rna_expression.h5ad
  - Optimal proportion: /dcs07/hongkai/data/harry/result/multi_omics_unpaired/multiomics/resolution_optimization_proportion/Integration_optimization_rna_proportion/summary/optimal_rna_proportion.h5ad
  - Pseudobulk sample: /dcs07/hongkai/data/harry/result/multi_omics_unpaired/multiomics/pseudobulk/pseudobulk_sample.h5ad

[Replace DR] Loading files...
  ✓ Optimal expression loaded: (431, 264179)
  ✓ Optimal proportion loaded: (431, 325083)
  ✓ Pseudobulk sample loaded: (431, 18000)

[Replace DR] Replacing EXPRESSION dimension reduction results...
  ✓ Copied .uns['X_DR_expression'] (shape: (431, 30))
  ✓ Copied .uns['X_DR_expression_variance'] (shape: (30,))
  ✓ Copied .uns['X_DR_expression_variance_ratio'] (shape: (30,))
  ✓ Copied .uns['X_pca_expression_method'] (shape: (431, 30))
  ✓ Copied .obsm['X_DR_expression'] (shape: (431, 30))
  ✓ Copied .obsm['X_pca_expression_method'] (shape: (431, 30))
  → Total expression keys copied: 6

[Replace DR] Replacing PROPORTION dimension reduction results...
  ✓ Copied .uns['X_DR_proportion'] (shape: (431, 30))
  ✓ Copied .uns['X_DR_proportion_variance_ratio'] (shape: (30,))
  ✓ Copied .uns['pca_proportion_variance_ratio'] (shape: (30,))
  ✓ Copied .obsm['X_DR_proportion'] (shape: (431, 30))
  ✓ Copied .obsm['X_pca_proportion'] (shape: (431, 30))
  → Total proportion keys copied: 5

[Replace DR] Saving updated pseudobulk_sample...
  Destination: /dcs07/hongkai/data/harry/result/multi_omics_unpaired/multiomics/pseudobulk/pseudobulk_sample.h5ad
  ✓ Created backup: /dcs07/hongkai/data/harry/result/multi_omics_unpaired/multiomics/pseudobulk/pseudobulk_sample.h5ad.backup
  ✓ Successfully saved (31.9 MB)

----------------------------------------------------------------------
SUMMARY
----------------------------------------------------------------------
  Optimization target: RNA
  Expression DR keys copied: 6
  Proportion DR keys copied: 5
  Total keys updated: 11
  File updated: /dcs07/hongkai/data/harry/result/multi_omics_unpaired/multiomics/pseudobulk/pseudobulk_sample.h5ad
  Backup saved: /dcs07/hongkai/data/harry/result/multi_omics_unpaired/multiomics/pseudobulk/pseudobulk_sample.h5ad.backup
======================================================================

✓ Optimal resolution finding and embedding update completed successfully

Pipeline completed successfully!
Results saved to: /dcs07/hongkai/data/harry/result/multi_omics_unpaired/multiomics
Available results: ['adata', 'atac_pseudobulk_df', 'pseudobulk_adata', 'status_flags']
Final status flags: {'glue_integration': True, 'glue_preprocessing': True, 'glue_training': True, 'glue_gene_activity': True, 'glue_cell_types': True, 'glue_visualization': True, 'integration_preprocessing': True, 'dimensionality_reduction': True, 'embedding_visualization': True, 'optimal_resolution': True}
Completed steps: 10/10
GLUE sub-steps completed: 5/5

✓ Multiomics pipeline completed successfully!

============================================================
PIPELINE EXECUTION SUMMARY
============================================================
Multiomics Pipeline: ✓ COMPLETE
  - glue_integration: ✓
  - glue_preprocessing: ✓
  - glue_training: ✓
  - glue_gene_activity: ✓
  - glue_cell_types: ✓
  - glue_visualization: ✓
  - integration_preprocessing: ✓
  - dimensionality_reduction: ✓
  - embedding_visualization: ✓
  - optimal_resolution: ✓

Results saved to: /dcs07/hongkai/data/harry/result/multi_omics_unpaired
Status file: /dcs07/hongkai/data/harry/result/multi_omics_unpaired/sys_log/main_process_status.json
Execution time: 18.0762 seconds

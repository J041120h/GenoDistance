Linux system detected with GPU enabled.
Resuming process from previous progress:
{
    "rna": {
        "preprocessing": true,
        "cell_type_cluster": true,
        "dimensionality_reduction": true,
        "sample_distance_calculation": true,
        "trajectory_analysis": true,
        "trajectory_dge": true,
        "cluster_dge": true,
        "visualization": false
    },
    "atac": {
        "preprocessing": false,
        "cell_type_cluster": false,
        "dimensionality_reduction": false,
        "sample_distance_calculation": false,
        "trajectory_analysis": false,
        "trajectory_dge": false,
        "cluster_dge": false,
        "visualization": false
    },
    "multiomics": {
        "glue_integration": true,
        "glue_preprocessing": true,
        "glue_training": true,
        "glue_gene_activity": true,
        "glue_cell_types": true,
        "glue_visualization": true,
        "integration_preprocessing": true,
        "dimensionality_reduction": true,
        "embedding_visualization": true,
        "optimal_resolution": true
    },
    "system_info": {
        "platform": "Linux",
        "python_version": "3.10.18 | packaged by conda-forge | (main, Jun  4 2025, 14:45:41) [GCC 13.3.0]",
        "use_gpu": true,
        "linux_system": true
    }
}

============================================================
RUNNING RNA PIPELINE
============================================================
Starting RNA wrapper function with provided parameters...
Reading Pseudobulk from provided or default path: /dcs07/hongkai/data/harry/result/multi_omics_unpaired/multiomics/pseudobulk/pseudobulk_sample.h5ad
[INFO] Starting proportion tests...
[INFO] Proportion tests completed.
[INFO] Running RAISIN analysis...

===== Starting RAISIN fitting =====
Using 48 CPU cores
Available columns in adata.obs: ['sample', 'sev.level', 'balancing_weight', 'modality', 'original_barcode', 'cell_type', 'label_transfer_confidence', 'cell_type_original', 'celltypist_conf_score', 'original_sample', 'age_cluster', 'batch', 'sex', 'n_genes_by_counts', 'total_counts', 'pct_counts_in_top_50_genes', 'pct_counts_in_top_100_genes', 'pct_counts_in_top_200_genes', 'pct_counts_in_top_500_genes', 'total_counts_mt', 'pct_counts_mt', 'n_genes']
Note: group_col='sev.level' provided; sample_to_clade is ignored (not needed).

Batch correction requested using column: batch
Preserving biological effects from group_col: sev.level

===== Applying ComBat batch correction =====
Batch variable: batch
Preserving biological effects from: sev.level
Running ComBat correction...
Found 13 batches.
Adjusting for 3 covariate(s) or covariate level(s).
Standardizing Data across genes.
Fitting L/S model and finding priors.
Finding parametric adjustments.
Adjusting the Data
ComBat correction complete
Original expression stored in layer: 'original' or 'original_raw'
Using counts from adata.X
Using group_col='sev.level' for grouping
Expression matrix: 10175 genes x 987397 cells
Design matrix X: 431 samples x 5 features
Random effects Z: 431 samples x 431 effects
Unique variance groups: ['1' '2' '3' '4']

===== Estimating variance for group: 2 =====
  alpha=0.0010, gamma=0.0016

===== Estimating variance for group: 4 =====
  alpha=0.0005, gamma=0.0003

===== Estimating variance for group: 3 =====
  alpha=0.0007, gamma=0.0010

===== Estimating variance for group: 1 =====
  alpha=0.0003, gamma=0.0002

===== Model fitting complete =====
Note: ComBat batch correction was applied
Starting pairwise comparisons. Found 6 pairs.
Testing: 1_vs_2
Testing: 1_vs_3
Testing: 1_vs_4
Testing: 2_vs_3
Testing: 2_vs_4
Testing: 3_vs_4

Generating Visualizations...
Saved Pseudobulk Heatmap: /dcs07/hongkai/data/harry/result/multi_omics_unpaired/rna/raisin_results_expression/average/summary_plots/pseudobulk_heatmap.png
[INFO] RAISIN analysis completed.
RNA analysis completed successfully!

✓ RNA pipeline completed successfully!

============================================================
PIPELINE EXECUTION SUMMARY
============================================================
RNA Pipeline: ⚠ PARTIAL
  - preprocessing: ✓
  - cell_type_cluster: ✓
  - dimensionality_reduction: ✓
  - sample_distance_calculation: ✓
  - trajectory_analysis: ✓
  - trajectory_dge: ✓
  - cluster_dge: ✓
  - visualization: ✗

Results saved to: /dcs07/hongkai/data/harry/result/multi_omics_unpaired
Status file: /dcs07/hongkai/data/harry/result/multi_omics_unpaired/sys_log/main_process_status.json
Execution time: 1133.9190 seconds

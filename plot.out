Resuming process from previous progress:
{
    "rna": {
        "preprocessing": true,
        "cell_type_cluster": true,
        "dimensionality_reduction": true,
        "sample_distance_calculation": true,
        "trajectory_analysis": true,
        "trajectory_dge": false,
        "cluster_dge": false,
        "visualization": true
    },
    "atac": {
        "preprocessing": false,
        "cell_type_cluster": false,
        "dimensionality_reduction": false,
        "sample_distance_calculation": false,
        "trajectory_analysis": false,
        "trajectory_dge": false,
        "cluster_dge": false,
        "visualization": false
    },
    "multiomics": {
        "glue_integration": false,
        "glue_preprocessing": false,
        "glue_training": false,
        "glue_gene_activity": false,
        "glue_cell_types": false,
        "glue_visualization": false,
        "integration_preprocessing": false,
        "dimensionality_reduction": false,
        "embedding_visualization": false,
        "optimal_resolution": false
    },
    "system_info": {
        "platform": "Linux",
        "python_version": "3.10.18 | packaged by conda-forge | (main, Jun  4 2025, 14:45:41) [GCC 13.3.0]",
        "use_gpu": false,
        "linux_system": false
    }
}

============================================================
RUNNING RNA PIPELINE
============================================================
Starting RNA wrapper function with provided parameters...
Starting dimensionality reduction...
[Seed Control] PyTorch GPU deterministic mode enabled with seed=42
[Seed Control] CuPy seed set to 42
[Seed Control] Scanpy seed set to 42
[pseudobulk-CPU] Batch correction enabled: True (col='batch')
[pseudobulk-CPU] 9 cell types, 25 samples
[pseudobulk-CPU] ComBat timeout: 1800s
[pseudobulk-CPU] Creating layer for 1
[pseudobulk-CPU] Creating layer for 2
[pseudobulk-CPU] Creating layer for 3
[pseudobulk-CPU] Creating layer for 4
[pseudobulk-CPU] Creating layer for 5
[pseudobulk-CPU] Creating layer for 6
[pseudobulk-CPU] Creating layer for 7
[pseudobulk-CPU] Creating layer for 8
[pseudobulk-CPU] Creating layer for 9

[pseudobulk-CPU] Processing cell type: 1
  - Skipping ComBat (min batch size=1 < 2).
  - Applying limma batch regression (~ batch).
  - limma batch regression applied.
  - Batch correction method: limma
  - Selecting top 2000 HVGs
  - Selected 2000 HVGs.

[pseudobulk-CPU] Processing cell type: 2
  - Skipping ComBat (min batch size=1 < 2).
  - Applying limma batch regression (~ batch).
  - limma batch regression applied.
  - Batch correction method: limma
  - Selecting top 2000 HVGs
  - Selected 2000 HVGs.

[pseudobulk-CPU] Processing cell type: 3
  - Skipping ComBat (min batch size=1 < 2).
  - Applying limma batch regression (~ batch).
  - limma batch regression applied.
  - Batch correction method: limma
  - Selecting top 2000 HVGs
  - Selected 2000 HVGs.

[pseudobulk-CPU] Processing cell type: 4
  - Skipping ComBat (min batch size=1 < 2).
  - Applying limma batch regression (~ batch).
  - limma batch regression applied.
  - Batch correction method: limma
  - Selecting top 2000 HVGs
  - Selected 2000 HVGs.

[pseudobulk-CPU] Processing cell type: 5
  - Skipping ComBat (min batch size=1 < 2).
  - Applying limma batch regression (~ batch).
  - limma batch regression applied.
  - Batch correction method: limma
  - Selecting top 2000 HVGs
  - Selected 2000 HVGs.

[pseudobulk-CPU] Processing cell type: 6
  - Skipping ComBat (min batch size=1 < 2).
  - Applying limma batch regression (~ batch).
  - limma batch regression applied.
  - Batch correction method: limma
  - Selecting top 2000 HVGs
  - Selected 2000 HVGs.

[pseudobulk-CPU] Processing cell type: 7
  - Skipping ComBat (min batch size=1 < 2).
  - Applying limma batch regression (~ batch).
  - limma batch regression applied.
  - Batch correction method: limma
  - Selecting top 2000 HVGs
  - Selected 2000 HVGs.

[pseudobulk-CPU] Processing cell type: 8
  - Skipping ComBat (min batch size=1 < 2).
  - Applying limma batch regression (~ batch).
  - limma batch regression applied.
  - Batch correction method: limma
  - Selecting top 2000 HVGs
  - Selected 2000 HVGs.

[pseudobulk-CPU] Processing cell type: 9
  - Skipping ComBat (min batch size=1 < 2).
  - Applying limma batch regression (~ batch).
  - limma batch regression applied.
  - Batch correction method: limma
  - Selecting top 2000 HVGs
  - Selected 2000 HVGs.

[pseudobulk-CPU] Summary:
  - Successful cell types: 9
  - Failed/empty cell types: 0

[pseudobulk-CPU] Concatenating HVGs across cell types.
[pseudobulk-CPU] Final HVG selection on concatenated matrix (genes=18000).
[pseudobulk-CPU] Final HVGs retained: 2000
[pseudobulk-CPU] Building final HVG expression matrix (CT x sample).

[pseudobulk-CPU] Done. Runtime: 13.22 s
[pseudobulk-CPU] Final HVG matrix shape: (9, 25)
[pseudobulk-CPU] Final AnnData shape: (25, 2000)
[process_anndata_with_dimension_reduction] Starting dimension reduction computation...
[process_anndata_with_dimension_reduction] Results will be stored under unified keys:
  - X_DR_expression: for expression data
  - X_DR_proportion: for proportion data
[process_anndata_with_dimension_reduction] RNA mode: Will use PCA for expression data
[process_anndata_with_dimension_reduction] ✓ Created output directories:
  - count_output_dir: /dcs07/hongkai/data/harry/result/Benchmark_covid/covid_25_sample/rna/preprocess
  - pseudobulk_output_dir: /dcs07/hongkai/data/harry/result/Benchmark_covid/covid_25_sample/rna/pseudobulk
[process_anndata_with_dimension_reduction] Using n_expression_components=10, n_proportion_components=5
[process_anndata_with_dimension_reduction] Data dimensions: expression=(25, 2000), proportion=(25, 9)
[DimRed] Computing PCA for RNA data with 10 components on (25, 2000) data
[PCA] Success. Shape: (25, 10)
[Storage] Stored X_DR_expression in both adata and pseudobulk_anndata (shape: (25, 10))
[Storage] Stored X_pca_expression_method in both adata and pseudobulk_anndata (shape: (25, 10))
[PCA] Stored variance information in both objects
[DimRed] Completed - results stored as X_DR_expression in both adata and pseudobulk_anndata
[process_anndata_with_dimension_reduction] ✓ Expression dimension reduction completed successfully
[run_dimension_reduction_proportion] Computing PCA with 5 components...
[run_dimension_reduction_proportion] Applying Harmony with batch: batch
[run_dimension_reduction_proportion] Harmony completed. Shape: (25, 5)
[run_dimension_reduction_proportion] Completed using Harmony-integrated PCA. Shape: (25, 5)
[process_anndata_with_dimension_reduction] ✓ Proportion dimension reduction completed successfully
[process_anndata_with_dimension_reduction] Preparing to save results...
[process_anndata_with_dimension_reduction] Target file paths:
  - adata: /dcs07/hongkai/data/harry/result/Benchmark_covid/covid_25_sample/rna/preprocess/adata_sample.h5ad
  - pseudobulk_anndata: /dcs07/hongkai/data/harry/result/Benchmark_covid/covid_25_sample/rna/pseudobulk/pseudobulk_sample.h5ad
[Save] Saving adata to: /dcs07/hongkai/data/harry/result/Benchmark_covid/covid_25_sample/rna/preprocess/adata_sample.h5ad
[Save] ✓ Successfully saved adata (207.0 MB)
[Save] Saving pseudobulk_anndata to: /dcs07/hongkai/data/harry/result/Benchmark_covid/covid_25_sample/rna/pseudobulk/pseudobulk_sample.h5ad
[Save] ✓ Successfully saved pseudobulk_anndata (0.7 MB)
[process_anndata_with_dimension_reduction] ✓ All files saved successfully

[process_anndata_with_dimension_reduction] === SUMMARY ===
Total runtime: 16.14 seconds
Expression dimension reduction: ✓ SUCCESS
Proportion dimension reduction: ✓ SUCCESS
Results available under unified keys:
  - X_DR_expression in both adata.uns and pseudobulk_anndata.uns
  - X_DR_proportion in both adata.uns and pseudobulk_anndata.uns
File saving: ✓ ATTEMPTED
Starting visualization...
[_preprocessing] Verified required columns in pseudobulk AnnData: ['sev.level', 'batch']
Found 9 unique cell types.
Dendrogram saved to: /dcs07/hongkai/data/harry/result/Benchmark_covid/covid_25_sample/rna/visualization/cell_type_dendrogram.png
Generating cell type proportion PCA plots for grouping columns: ['sev.level', 'batch']
Figure saved to: /dcs07/hongkai/data/harry/result/Benchmark_covid/covid_25_sample/rna/visualization/proportion_embedding_sev.level.png
Proportion embedding plot saved to: /dcs07/hongkai/data/harry/result/Benchmark_covid/covid_25_sample/rna/visualization/proportion_embedding_sev.level.png
Figure saved to: /dcs07/hongkai/data/harry/result/Benchmark_covid/covid_25_sample/rna/visualization/proportion_embedding_batch.png
Proportion embedding plot saved to: /dcs07/hongkai/data/harry/result/Benchmark_covid/covid_25_sample/rna/visualization/proportion_embedding_batch.png
Generating cell type expression plots for grouping columns: ['sev.level', 'batch']
Figure saved to: /dcs07/hongkai/data/harry/result/Benchmark_covid/covid_25_sample/rna/visualization/expression_embedding_sev.level.png
Expression embedding plot saved to: /dcs07/hongkai/data/harry/result/Benchmark_covid/covid_25_sample/rna/visualization/expression_embedding_sev.level.png
Figure saved to: /dcs07/hongkai/data/harry/result/Benchmark_covid/covid_25_sample/rna/visualization/expression_embedding_batch.png
Expression embedding plot saved to: /dcs07/hongkai/data/harry/result/Benchmark_covid/covid_25_sample/rna/visualization/expression_embedding_batch.png
[visualization] All requested visualizations saved.
RNA analysis completed successfully!

✓ RNA pipeline completed successfully!

============================================================
PIPELINE EXECUTION SUMMARY
============================================================
RNA Pipeline: ⚠ PARTIAL
  - preprocessing: ✓
  - cell_type_cluster: ✓
  - dimensionality_reduction: ✓
  - sample_distance_calculation: ✓
  - trajectory_analysis: ✓
  - trajectory_dge: ✗
  - cluster_dge: ✗
  - visualization: ✓

Results saved to: /dcs07/hongkai/data/harry/result/Benchmark_covid/covid_25_sample
Status file: /dcs07/hongkai/data/harry/result/Benchmark_covid/covid_25_sample/sys_log/main_process_status.json
Execution time: 36.5610 seconds

Linux system detected with GPU enabled.
Resuming process from previous progress:
{
    "rna": {
        "preprocessing": false,
        "cell_type_cluster": false,
        "dimensionality_reduction": false,
        "sample_distance_calculation": false,
        "trajectory_analysis": false,
        "trajectory_dge": false,
        "cluster_dge": false,
        "visualization": false
    },
    "atac": {
        "preprocessing": false,
        "cell_type_cluster": false,
        "dimensionality_reduction": false,
        "sample_distance_calculation": false,
        "trajectory_analysis": false,
        "trajectory_dge": false,
        "cluster_dge": false,
        "visualization": false
    },
    "multiomics": {
        "glue_integration": false,
        "glue_preprocessing": false,
        "glue_training": false,
        "glue_gene_activity": false,
        "glue_cell_types": false,
        "glue_visualization": false,
        "integration_preprocessing": false,
        "dimensionality_reduction": false,
        "embedding_visualization": false,
        "optimal_resolution": false
    },
    "system_info": {
        "platform": "Linux",
        "python_version": "3.10.18 | packaged by conda-forge | (main, Jun  4 2025, 14:45:41) [GCC 13.3.0]",
        "use_gpu": true,
        "linux_system": true
    }
}

============================================================
RUNNING MULTIOMICS PIPELINE
============================================================
Starting multi-modal pipeline with output directory: /dcs07/hongkai/data/harry/result/multi_omics_heart/multiomics
Initial status flags: {'glue_integration': False, 'glue_preprocessing': False, 'glue_training': False, 'glue_gene_activity': False, 'glue_cell_types': False, 'glue_visualization': False, 'integration_preprocessing': False, 'dimensionality_reduction': False, 'embedding_visualization': False, 'optimal_resolution': False}
Step 1: Running GLUE integration...
  Sub-steps: Preprocessing=True, Training=True, Gene Activity=True, Cell Types=True, Visualization=True
Running preprocessing...

ğŸš€ Starting GLUE preprocessing pipeline...

   Feature selection mode: Highly Variable

ğŸ“Š Loading data files...
   RNA: /dcs07/hongkai/data/harry/result/multi_omics_heart/data/rna_raw.h5ad
   ATAC: /dcs07/hongkai/data/harry/result/multi_omics_heart/data/atac_raw.h5ad
âœ… Data loaded successfully
   RNA shape: (99438, 38606)
   ATAC shape: (99438, 3576085)

ğŸ“‹ Loading and merging sample metadata...
   Processing RNA metadata: /dcs07/hongkai/data/harry/result/multi_omics_heart/data/multi_omics_heart_sample_meta.csv
   Merged 11 sample-level columns
   Matched metadata for 99438/99438 samples
   Processing ATAC metadata: /dcs07/hongkai/data/harry/result/multi_omics_heart/data/multi_omics_heart_sample_meta.csv
   Merged 11 sample-level columns
   Matched metadata for 99438/99438 samples

âœ… Metadata integration and standardization complete
   RNA obs columns: ['database', 'dataset', 'batch', 'tissue', 'libsize_rna', 'libsize_atac', 'source_file', 'sample', 'age', 'sex', 'disease_state', 'organ_part', 'Unnamed: 5', 'Unnamed: 6', 'Unnamed: 7', 'Unnamed: 8', 'Unnamed: 9', 'Unnamed: 10', 'Unnamed: 11']
   ATAC obs columns: ['database', 'dataset', 'batch', 'tissue', 'libsize_rna', 'libsize_atac', 'source_file', 'sample', 'age', 'sex', 'disease_state', 'organ_part', 'Unnamed: 5', 'Unnamed: 6', 'Unnamed: 7', 'Unnamed: 8', 'Unnamed: 9', 'Unnamed: 10', 'Unnamed: 11']

ğŸ§¬ Setting up Ensembl annotation...
   Release: 110
   Species: homo_sapiens
âœ… Ensembl annotation ready

ğŸ§¬ Preprocessing scRNA-seq data...
   Selecting 1500 highly variable genes
   Computing 50 PCA components
âœ… RNA preprocessing complete

ğŸ”ï¸ Preprocessing scATAC-seq data...
   Computing feature statistics for peak selection
   Selected 50000 highly accessible peaks
   Computing 50 LSI components (15 iterations)
âœ… ATAC preprocessing complete

ğŸ” Detecting gene ID format...
   Detected Ensembl gene IDs format

ğŸ—ºï¸ Processing gene coordinates...
   Processing 38606 genes...
âœ… Gene coordinate processing complete
   38606 genes retained
   Final RNA shape: (99438, 38606)

ğŸ”ï¸ Processing ATAC peak coordinates...
   Processing 3576085 peaks...
âœ… ATAC peak coordinates extracted successfully

ğŸ•¸ï¸ Constructing guidance graph...
   Using highly variable features for graph construction
[INFO] check_graph: Checking variable coverage...
[INFO] check_graph: Checking edge attributes...
[INFO] check_graph: Checking self-loops...
[INFO] check_graph: Checking graph symmetry...
[INFO] check_graph: All checks passed!
âœ… Guidance graph constructed successfully
   Nodes: 3,614,691
   Edges: 9,176,261

ğŸ’¾ Saving preprocessed data...
   Output directory: /dcs07/hongkai/data/harry/result/multi_omics_heart/multiomics/integration/glue
   Saving RNA data...
[safe_h5ad_write] Preparing to save to: /dcs07/hongkai/data/harry/result/multi_omics_heart/multiomics/integration/glue/rna-pp.h5ad
[clean_obs_for_saving] Cleaning observation metadata for H5AD compatibility...
[clean_obs_for_saving] Cleaning completed successfully
[clean_obs_for_saving] 10 categorical columns processed
[safe_h5ad_write] Writing H5AD file...
[safe_h5ad_write] Successfully saved to: /dcs07/hongkai/data/harry/result/multi_omics_heart/multiomics/integration/glue/rna-pp.h5ad
   Saving ATAC data...
[safe_h5ad_write] Preparing to save to: /dcs07/hongkai/data/harry/result/multi_omics_heart/multiomics/integration/glue/atac-pp.h5ad
[clean_obs_for_saving] Cleaning observation metadata for H5AD compatibility...
[clean_obs_for_saving] Cleaning completed successfully
[clean_obs_for_saving] 10 categorical columns processed
[safe_h5ad_write] Writing H5AD file...
[safe_h5ad_write] Successfully saved to: /dcs07/hongkai/data/harry/result/multi_omics_heart/multiomics/integration/glue/atac-pp.h5ad
   Saving guidance graph...

ğŸ‰ GLUE preprocessing pipeline completed successfully!

Preprocessing completed.
Running training...



ğŸš€ Starting GLUE training pipeline...



   Feature mode: Highly Variable Only
   Output directory: /dcs07/hongkai/data/harry/result/multi_omics_heart/multiomics/integration/glue




ğŸ“Š Loading preprocessed data from /dcs07/hongkai/data/harry/result/multi_omics_heart/multiomics/integration/glue...






Data loaded - RNA: (99438, 38606), ATAC: (99438, 3576085), Graph: 3614691 nodes






âš™ï¸ Configuring datasets...






ğŸ” Extracting highly variable feature subgraph...



HVF subgraph extracted - RNA HVF: 1500, ATAC HVF: 315354
HVF graph: 316854 nodes, 954896 edges






ğŸ¤– Training GLUE model...



[INFO] fit_SCGLUE: Pretraining SCGLUE model...
[INFO] autodevice: Using GPU 0 as computation device.
[INFO] check_graph: Checking variable coverage...
[INFO] check_graph: Checking edge attributes...
[INFO] check_graph: Checking self-loops...
[INFO] check_graph: Checking graph symmetry...
[INFO] SCGLUEModel: Setting `graph_batch_size` = 328246
[INFO] SCGLUEModel: Setting `patience` = 4
[INFO] SCGLUEModel: Setting `reduce_lr_patience` = 2
[INFO] SCGLUETrainer: Using training directory: "/dcs07/hongkai/data/harry/result/multi_omics_heart/multiomics/integration/glue/training/pretrain"

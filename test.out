======================================
 Job ID:            21705725
 Job Name:          test
 Partition:         gpu
 Node List:         compute-170
 CPUs per Task:     16
 Memory Alloc:      1024000
 GPU Requested:     1
 Start Time:        Sat Aug 30 05:37:03 PM EDT 2025
======================================
Checking GPU status...
Sat Aug 30 17:37:06 2025       
+-----------------------------------------------------------------------------------------+
| NVIDIA-SMI 555.42.06              Driver Version: 555.42.06      CUDA Version: 12.5     |
|-----------------------------------------+------------------------+----------------------+
| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |
| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |
|                                         |                        |               MIG M. |
|=========================================+========================+======================|
|   0  NVIDIA H100 NVL                Off |   00000000:D1:00.0 Off |                    0 |
| N/A   41C    P0             90W /  400W |       1MiB /  95830MiB |      3%      Default |
|                                         |                        |             Disabled |
+-----------------------------------------+------------------------+----------------------+
                                                                                         
+-----------------------------------------------------------------------------------------+
| Processes:                                                                              |
|  GPU   GI   CI        PID   Type   Process name                              GPU Memory |
|        ID   ID                                                               Usage      |
|=========================================================================================|
|  No running processes found                                                             |
+-----------------------------------------------------------------------------------------+
Starting main.py...
Linux system detected with GPU enabled.
Initializing main process status file.

============================================================
RUNNING MULTIOMICS PIPELINE
============================================================
Starting multi-modal pipeline with output directory: /dcs07/hongkai/data/harry/result/multiomics
Initial status flags: {'glue_integration': False, 'glue_preprocessing': False, 'glue_training': False, 'glue_gene_activity': False, 'glue_cell_types': False, 'glue_visualization': False, 'integration_preprocessing': False, 'dimensionality_reduction': False, 'embedding_visualization': False, 'optimal_resolution': False}
Step 1: Running GLUE integration...
  Sub-steps: Preprocessing=True, Training=True, Gene Activity=True, Cell Types=True, Visualization=True
Running preprocessing...

üöÄ Starting GLUE preprocessing pipeline...

   Feature selection mode: Highly Variable

üìä Loading data files...
   RNA: /dcl01/hongkai/data/data/hjiang/Data/paired/rna/all.h5ad
   ATAC: /dcl01/hongkai/data/data/hjiang/Data/paired/atac/all.h5ad
‚úÖ Data loaded successfully
   RNA shape: (430595, 36601)
   ATAC shape: (430595, 3576085)

üìã Standardizing existing sample columns...
‚úÖ Sample column standardization complete

üß¨ Setting up Ensembl annotation...
   Release: 98
   Species: homo_sapiens
‚úÖ Ensembl annotation ready

üß¨ Preprocessing scRNA-seq data...
   Selecting 2000 highly variable genes
   Computing 50 PCA components
‚úÖ RNA preprocessing complete

üèîÔ∏è Preprocessing scATAC-seq data...
   Computing feature statistics for peak selection
   Selected 50000 highly accessible peaks
   Computing 50 LSI components (15 iterations)
‚úÖ ATAC preprocessing complete

üó∫Ô∏è Processing gene coordinates...
   Processing 36601 genes...
   ‚ö†Ô∏è Could not find coordinates for genes: TBCE.1, LINC01238.1, CYB561D2.1, MATR3.1, LINC01505.1, HSPA14.1, GOLGA8M.1, GGT1.1, ARMCX5-GPRASP2.1, TMSB15B.1
   Filtered out 10 genes without coordinates
‚úÖ Gene coordinate processing complete
   36591 genes retained
   Final RNA shape: (430595, 36591)

üèîÔ∏è Processing ATAC peak coordinates...
   Processing 3576085 peaks...
‚úÖ ATAC peak coordinates extracted successfully

üï∏Ô∏è Constructing guidance graph...
   Using highly variable features for graph construction
[INFO] check_graph: Checking variable coverage...
[INFO] check_graph: Checking edge attributes...
[INFO] check_graph: Checking self-loops...
[INFO] check_graph: Checking graph symmetry...
[INFO] check_graph: All checks passed!
‚úÖ Guidance graph constructed successfully
   Nodes: 3,612,676
   Edges: 9,027,876

üßπ Preparing data for saving...
üßπ Cleaning AnnData object for HDF5 compatibility...
   Processing column: sample
   Processing column: tissue
‚úÖ AnnData cleaning complete
üßπ Cleaning AnnData object for HDF5 compatibility...
   Processing column: sample
   Processing column: tissue
‚úÖ AnnData cleaning complete
üíæ Saving preprocessed data...
   Output directory: /dcs07/hongkai/data/harry/result/multiomics/integration/glue
   Saving RNA data...
   Saving ATAC data...
   Saving guidance graph...

üéâ GLUE preprocessing pipeline completed successfully!

Preprocessing completed.
Running training...



üöÄ Starting GLUE training pipeline...



   Feature mode: Highly Variable Only
   Output directory: /dcs07/hongkai/data/harry/result/multiomics/integration/glue




üìä Loading preprocessed data from /dcs07/hongkai/data/harry/result/multiomics/integration/glue...






Data loaded - RNA: (430595, 36591), ATAC: (430595, 3576085), Graph: 3612676 nodes






‚öôÔ∏è Configuring datasets...






üîç Extracting highly variable feature subgraph...



HVF subgraph extracted - RNA HVF: 2000, ATAC HVF: 436716
HVF graph: 438716 nodes, 1329664 edges






ü§ñ Training GLUE model...



[INFO] fit_SCGLUE: Pretraining SCGLUE model...
[INFO] autodevice: Using GPU 0 as computation device.
[INFO] check_graph: Checking variable coverage...
[INFO] check_graph: Checking edge attributes...
[INFO] check_graph: Checking self-loops...
[INFO] check_graph: Checking graph symmetry...
[INFO] SCGLUEModel: Setting `graph_batch_size` = 457072
[INFO] SCGLUEModel: Setting `max_epochs` = 48
[INFO] SCGLUEModel: Setting `patience` = 4
[INFO] SCGLUEModel: Setting `reduce_lr_patience` = 2
[INFO] SCGLUETrainer: Using training directory: "/dcs07/hongkai/data/harry/result/multiomics/integration/glue/training/pretrain"
[INFO] SCGLUETrainer: [Epoch 10] train={'g_nll': 0.403, 'g_kl': 0.0, 'g_elbo': 0.403, 'x_rna_nll': 0.218, 'x_rna_kl': 0.006, 'x_rna_elbo': 0.223, 'x_atac_nll': 0.009, 'x_atac_kl': 0.0, 'x_atac_elbo': 0.009, 'dsc_loss': 0.693, 'vae_loss': 0.248, 'gen_loss': 0.214}, val={'g_nll': 0.402, 'g_kl': 0.0, 'g_elbo': 0.402, 'x_rna_nll': 0.217, 'x_rna_kl': 0.006, 'x_rna_elbo': 0.223, 'x_atac_nll': 0.009, 'x_atac_kl': 0.0, 'x_atac_elbo': 0.009, 'dsc_loss': 0.693, 'vae_loss': 0.248, 'gen_loss': 0.213}, 1490.8s elapsed
[INFO] LRScheduler: Learning rate reduction: step 1
[INFO] SCGLUETrainer: [Epoch 20] train={'g_nll': 0.4, 'g_kl': 0.0, 'g_elbo': 0.4, 'x_rna_nll': 0.216, 'x_rna_kl': 0.006, 'x_rna_elbo': 0.222, 'x_atac_nll': 0.009, 'x_atac_kl': 0.0, 'x_atac_elbo': 0.009, 'dsc_loss': 0.693, 'vae_loss': 0.247, 'gen_loss': 0.212}, val={'g_nll': 0.4, 'g_kl': 0.0, 'g_elbo': 0.4, 'x_rna_nll': 0.216, 'x_rna_kl': 0.005, 'x_rna_elbo': 0.221, 'x_atac_nll': 0.009, 'x_atac_kl': 0.0, 'x_atac_elbo': 0.009, 'dsc_loss': 0.692, 'vae_loss': 0.246, 'gen_loss': 0.211}, 1480.2s elapsed
[INFO] LRScheduler: Learning rate reduction: step 2
[INFO] LRScheduler: Learning rate reduction: step 3
[INFO] EarlyStopping: Restoring checkpoint "27"...
[INFO] EarlyStopping: Restoring checkpoint "27"...
[INFO] fit_SCGLUE: Estimating balancing weight...
[INFO] estimate_balancing_weight: Clustering cells...
[INFO] estimate_balancing_weight: Matching clusters...
[INFO] estimate_balancing_weight: Matching array shape = (40, 27)...
[INFO] estimate_balancing_weight: Estimating balancing weight...
[INFO] fit_SCGLUE: Fine-tuning SCGLUE model...
[INFO] check_graph: Checking variable coverage...
[INFO] check_graph: Checking edge attributes...
[INFO] check_graph: Checking self-loops...
[INFO] check_graph: Checking graph symmetry...
[INFO] SCGLUEModel: Setting `graph_batch_size` = 457072
[INFO] SCGLUEModel: Setting `align_burnin` = 8
[INFO] SCGLUEModel: Setting `max_epochs` = 48
[INFO] SCGLUEModel: Setting `patience` = 4
[INFO] SCGLUEModel: Setting `reduce_lr_patience` = 2
[INFO] SCGLUETrainer: Using training directory: "/dcs07/hongkai/data/harry/result/multiomics/integration/glue/training/fine-tune"
[INFO] SCGLUETrainer: [Epoch 10] train={'g_nll': 0.402, 'g_kl': 0.0, 'g_elbo': 0.402, 'x_rna_nll': 0.217, 'x_rna_kl': 0.006, 'x_rna_elbo': 0.223, 'x_atac_nll': 0.009, 'x_atac_kl': 0.0, 'x_atac_elbo': 0.009, 'dsc_loss': 0.688, 'vae_loss': 0.248, 'gen_loss': 0.213}, val={'g_nll': 0.402, 'g_kl': 0.0, 'g_elbo': 0.402, 'x_rna_nll': 0.216, 'x_rna_kl': 0.005, 'x_rna_elbo': 0.221, 'x_atac_nll': 0.009, 'x_atac_kl': 0.0, 'x_atac_elbo': 0.009, 'dsc_loss': 0.691, 'vae_loss': 0.246, 'gen_loss': 0.212}, 1891.2s elapsed
[INFO] LRScheduler: Learning rate reduction: step 1

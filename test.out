Linux system detected with GPU enabled.
Resuming process from previous progress:
{
    "rna": {
        "preprocessing": false,
        "cell_type_cluster": false,
        "dimensionality_reduction": false,
        "sample_distance_calculation": false,
        "trajectory_analysis": false,
        "trajectory_dge": false,
        "cluster_dge": false,
        "visualization": false
    },
    "atac": {
        "preprocessing": false,
        "cell_type_cluster": false,
        "dimensionality_reduction": false,
        "sample_distance_calculation": false,
        "trajectory_analysis": false,
        "trajectory_dge": false,
        "cluster_dge": false,
        "visualization": false
    },
    "multiomics": {
        "glue_integration": false,
        "glue_preprocessing": false,
        "glue_training": false,
        "glue_gene_activity": false,
        "glue_cell_types": false,
        "glue_visualization": false,
        "integration_preprocessing": false,
        "dimensionality_reduction": false,
        "embedding_visualization": false,
        "optimal_resolution": false
    },
    "system_info": {
        "platform": "Linux",
        "python_version": "3.10.13 | packaged by conda-forge | (main, Dec 23 2023, 15:36:39) [GCC 12.3.0]",
        "use_gpu": true,
        "linux_system": true
    }
}

============================================================
RUNNING MULTIOMICS PIPELINE
============================================================
Starting multi-modal pipeline with output directory: /dcs07/hongkai/data/harry/result/Benchmark/multiomics
Initial status flags: {'glue_integration': False, 'glue_preprocessing': False, 'glue_training': False, 'glue_gene_activity': False, 'glue_cell_types': False, 'glue_visualization': False, 'integration_preprocessing': False, 'dimensionality_reduction': False, 'embedding_visualization': False, 'optimal_resolution': False}
Step 1: Running GLUE integration...
  Sub-steps: Preprocessing=False, Training=False, Gene Activity=True, Cell Types=True, Visualization=False
Computing gene activity...

üß¨ Computing gene activity using raw RNA counts (CPU-optimized)...
   k_neighbors: 10
   metric: cosine
   CPU cores: 48
   Available memory: 1037.77 GB

üìÇ Loading and standardizing raw RNA to CSR format...
   Raw RNA standardized to CSR: (430595, 36601), sparsity: 94.6%

üìÇ Loading processed RNA embeddings...
üìÇ Loading ATAC embeddings...
   RNA cells: 430595, ATAC cells: 430595, Genes: 36601

üîç Finding k-nearest RNA neighbors (CPU-optimized)...
   Processing in 87 batches of size 5000
      k-NN progress: 9.2%
      k-NN progress: 18.4%
      k-NN progress: 27.6%
      k-NN progress: 36.8%
      k-NN progress: 46.0%
      k-NN progress: 55.2%
      k-NN progress: 64.4%
      k-NN progress: 73.6%
      k-NN progress: 82.8%
      k-NN progress: 92.0%
   k-NN search completed in 2124.98 seconds

üìê Computing similarity weights...

üßÆ Computing weighted gene activity...
   Processing in 431 batches of size 1000
   Progress: 10.0% (43/431 batches, ETA: 97.1s)
   Progress: 20.0% (86/431 batches, ETA: 84.1s)
   Progress: 29.9% (129/431 batches, ETA: 73.8s)
   Progress: 39.9% (172/431 batches, ETA: 62.3s)
   Progress: 49.9% (215/431 batches, ETA: 51.7s)
   Progress: 59.9% (258/431 batches, ETA: 41.5s)
   Progress: 69.8% (301/431 batches, ETA: 30.8s)
   Progress: 79.8% (344/431 batches, ETA: 20.4s)
   Progress: 89.8% (387/431 batches, ETA: 10.3s)
   Progress: 99.8% (430/431 batches, ETA: 0.2s)
   Progress: 100.0% (431/431 batches, ETA: 0.0s)
   Gene activity computation completed in 100.77 seconds

üîç Creating sparse CSR matrices for integration...
   Gene activity sparsity: 76.3% zeros

üîó Preparing RNA data for merging (keeping CSR format)...
üîó Merging gene activity with RNA data (maintaining CSR format)...

üíæ Saving integrated dataset...

‚úÖ Gene activity computation and merging complete!

üìä Summary:
   Output path: /dcs07/hongkai/data/harry/result/Benchmark/multiomics/preprocess/atac_rna_integrated.h5ad
   Merged dataset shape: (861190, 36601)
   RNA cells: 430595
   ATAC cells: 430595
   Matrix format: csr_matrix (CSR sparse)
   Data type: float64
   Sparsity: 85.5% zeros
   Memory usage: 73327.91 MB (sparse)
   Optimization: CPU-optimized with efficient batching and sparse operations
Gene activity computation completed.
Assigning cell types...
 Using Linux Cell Type Assignment for cell type assignment...
[cell_types] No cell type annotation found. Performing clustering.
[cell_types] Building neighborhood graph...
[cell_types] No target clusters specified. Using standard Leiden clustering (resolution=0.8)...
[cell_types] Found 32 clusters after Leiden clustering.
[cell_types] Finished assigning cell types.
[cell_types] Converting GPU arrays to CPU...
[safe_h5ad_write] Preparing to save to: /dcs07/hongkai/data/harry/result/Benchmark/multiomics/preprocess/atac_rna_integrated.h5ad
[clean_obs_for_saving] Cleaning observation metadata for H5AD compatibility...
[clean_obs_for_saving] Cleaning completed successfully
[clean_obs_for_saving] 4 categorical columns processed
[safe_h5ad_write] Writing H5AD file...
[safe_h5ad_write] Successfully saved to: /dcs07/hongkai/data/harry/result/Benchmark/multiomics/preprocess/atac_rna_integrated.h5ad
[cell_types] Total runtime: 179.92 seconds

Total runtime: 64.48 minutes
‚úì GLUE integration completed successfully
  Completed 2/5 GLUE sub-steps
Step 2: Running integration preprocessing...
Minimum dimension requested by scrublet is 30, raise sample standard accordingly
=== Read input dataset ===
Dimension of raw data (cells x genes): 861190 x 36601
Modified sample IDs by adding modality information from 'modality' column

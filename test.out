Linux system detected with GPU enabled.
Resuming process from previous progress:
{
    "rna": {
        "preprocessing": false,
        "cell_type_cluster": false,
        "dimensionality_reduction": false,
        "sample_distance_calculation": false,
        "trajectory_analysis": false,
        "trajectory_dge": false,
        "cluster_dge": false,
        "visualization": false
    },
    "atac": {
        "preprocessing": false,
        "cell_type_cluster": false,
        "dimensionality_reduction": false,
        "sample_distance_calculation": false,
        "trajectory_analysis": false,
        "trajectory_dge": false,
        "cluster_dge": false,
        "visualization": false
    },
    "multiomics": {
        "glue_integration": false,
        "glue_preprocessing": false,
        "glue_training": false,
        "glue_gene_activity": false,
        "glue_cell_types": false,
        "glue_visualization": false,
        "integration_preprocessing": false,
        "dimensionality_reduction": false,
        "embedding_visualization": false,
        "optimal_resolution": false
    },
    "system_info": {
        "platform": "Linux",
        "python_version": "3.10.13 | packaged by conda-forge | (main, Dec 23 2023, 15:36:39) [GCC 12.3.0]",
        "use_gpu": true,
        "linux_system": true
    }
}

============================================================
RUNNING MULTIOMICS PIPELINE
============================================================
Starting multi-modal pipeline with output directory: /dcs07/hongkai/data/harry/result/multiomics
Initial status flags: {'glue_integration': False, 'glue_preprocessing': False, 'glue_training': False, 'glue_gene_activity': False, 'glue_cell_types': False, 'glue_visualization': False, 'integration_preprocessing': False, 'dimensionality_reduction': False, 'embedding_visualization': False, 'optimal_resolution': False}
Step 1: Running GLUE integration...
  Sub-steps: Preprocessing=False, Training=False, Gene Activity=True, Cell Types=True, Visualization=True
Computing gene activity...

üß¨ Computing gene activity using raw RNA counts (highly optimized)...
   k_neighbors: 10
   metric: cosine
   GPU acceleration: enabled
   Available GPU memory: 33.75 GB
   Available CPU memory: 802.39 GB
üìÇ Loading processed RNA embeddings...
üìÇ Loading ATAC embeddings...
üìÇ Loading raw RNA counts...
   RNA cells: 430595, ATAC cells: 430595, Genes: 36601

üîç Finding k-nearest RNA neighbors (GPU-accelerated)...
   k-NN search completed in 6.26 seconds

üìê Computing similarity weights on GPU...

üßÆ Computing weighted gene activity...
   Optimal batch size: 10000
   Progress: 9.1% (4/44 batches)
   Progress: 18.2% (8/44 batches)
   Progress: 27.3% (12/44 batches)
   Progress: 36.4% (16/44 batches)
   Progress: 45.5% (20/44 batches)
   Progress: 54.5% (24/44 batches)
   Progress: 63.6% (28/44 batches)
   Progress: 72.7% (32/44 batches)
   Progress: 81.8% (36/44 batches)
   Progress: 90.9% (40/44 batches)
   Progress: 100.0% (44/44 batches)
   Gene activity computation completed in 32523.78 seconds

üîç Validating gene activity counts...

üîó Preparing RNA data for merging...
üîó Merging gene activity with RNA data...

‚úÖ Gene activity computation and merging complete!

üìä Summary:
   Output path: /dcs07/hongkai/data/harry/result/multiomics/preprocess/atac_rna_integrated.h5ad
   Merged dataset shape: (861190, 36601)
   RNA cells: 430595
   ATAC cells: 430595
   Optimization: GPU vectorization + dynamic batching
   Batch processing: 44 batches of size 10000
Gene activity computation completed.
Assigning cell types...
[cell_types] No cell type annotation found. Performing clustering.
[cell_types] Building neighborhood graph...

‚úó Multiomics pipeline failed with error: Did not find X_glue in `.obsm.keys()`. You need to compute it first.

============================================================
PIPELINE EXECUTION SUMMARY
============================================================
Multiomics Pipeline: ‚ö† PARTIAL
  - glue_integration: ‚úó
  - glue_preprocessing: ‚úó
  - glue_training: ‚úó
  - glue_gene_activity: ‚úó
  - glue_cell_types: ‚úó
  - glue_visualization: ‚úó
  - integration_preprocessing: ‚úó
  - dimensionality_reduction: ‚úó
  - embedding_visualization: ‚úó
  - optimal_resolution: ‚úó

Results saved to: /dcs07/hongkai/data/harry/result
Status file: /dcs07/hongkai/data/harry/result/sys_log/main_process_status.json

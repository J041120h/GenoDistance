Linux system detected with GPU enabled.
Resuming process from previous progress:
{
    "rna": {
        "preprocessing": false,
        "cell_type_cluster": false,
        "dimensionality_reduction": false,
        "sample_distance_calculation": false,
        "trajectory_analysis": false,
        "trajectory_dge": false,
        "cluster_dge": false,
        "visualization": false
    },
    "atac": {
        "preprocessing": false,
        "cell_type_cluster": false,
        "dimensionality_reduction": false,
        "sample_distance_calculation": false,
        "trajectory_analysis": false,
        "trajectory_dge": false,
        "cluster_dge": false,
        "visualization": false
    },
    "multiomics": {
        "glue_integration": true,
        "glue_preprocessing": true,
        "glue_training": true,
        "glue_gene_activity": true,
        "glue_cell_types": true,
        "glue_visualization": true,
        "integration_preprocessing": true,
        "dimensionality_reduction": true,
        "embedding_visualization": true,
        "optimal_resolution": false
    },
    "system_info": {
        "platform": "Linux",
        "python_version": "3.10.18 | packaged by conda-forge | (main, Jun  4 2025, 14:45:41) [GCC 13.3.0]",
        "use_gpu": true,
        "linux_system": true
    }
}

============================================================
RUNNING MULTIOMICS PIPELINE
============================================================
Starting multi-modal pipeline with output directory: /dcs07/hongkai/data/harry/result/multi_omics_heart/multiomics
Initial status flags: {'glue_integration': True, 'glue_preprocessing': True, 'glue_training': True, 'glue_gene_activity': True, 'glue_cell_types': True, 'glue_visualization': True, 'integration_preprocessing': True, 'dimensionality_reduction': True, 'embedding_visualization': True, 'optimal_resolution': False}
Step 2: Running integration preprocessing...
=== Read input dataset ===
Dimension of raw data (cells x genes): 198876 x 38606
Stored original sample IDs in adata.obs['original_sample'].
Detected non-unique 'sample' values (22 duplicated sample IDs across 198876 rows). Appended modality from 'modality' only for those rows.
After cell filtering -- Cells remaining: 79418, Genes remaining: 38606
After gene filtering -- Cells remaining: 79418, Genes remaining: 24086
After remove MT_gene and user input gene -- Cells remaining: 79418, Genes remaining: 24086
Sample counts BEFORE filtering:
sample
MA14_heart_RNA     4203
MA10_heart_RNA     4197
MA9_heart_RNA      4047
MA31_heart_ATAC    3611
MA29_heart_ATAC    3401
MA9_heart_ATAC     3096
MA10_heart_ATAC    3007
MA8_heart_RNA      2941
MA14_heart_ATAC    2657
MA31_heart_RNA     2610
MA33_heart_ATAC    2578
MA23_heart_ATAC    2561
MA19_heart_ATAC    2376
MA24_heart_ATAC    2343
MA8_heart_ATAC     2290
MA29_heart_RNA     2275
MA28_heart_ATAC    2093
MA22_heart_ATAC    1869
MA28_heart_RNA     1767
MA33_heart_RNA     1759
MA6_heart_RNA      1738
MA25_heart_ATAC    1656
MA11_heart_RNA     1653
MA19_heart_RNA     1514
MA27_heart_ATAC    1492
MA32_heart_ATAC    1475
MA6_heart_ATAC     1452
MA27_heart_RNA     1397
MA5_heart_RNA      1303
MA20_heart_ATAC    1282
MA5_heart_ATAC     1108
MA32_heart_RNA     1060
MA11_heart_ATAC    1050
MA26_heart_ATAC     991
MA24_heart_RNA      885
MA22_heart_RNA      777
MA23_heart_RNA      607
MA7_heart_RNA       440
MA13_heart_RNA      417
MA20_heart_RNA      340
MA7_heart_ATAC      331
MA25_heart_RNA      312
MA13_heart_ATAC     234
MA26_heart_RNA      223
dtype: int64

Samples retained (>= 100 cells): ['MA10_heart_ATAC', 'MA10_heart_RNA', 'MA11_heart_ATAC', 'MA11_heart_RNA', 'MA13_heart_ATAC', 'MA13_heart_RNA', 'MA14_heart_ATAC', 'MA14_heart_RNA', 'MA19_heart_ATAC', 'MA19_heart_RNA', 'MA20_heart_ATAC', 'MA20_heart_RNA', 'MA22_heart_ATAC', 'MA22_heart_RNA', 'MA23_heart_ATAC', 'MA23_heart_RNA', 'MA24_heart_ATAC', 'MA24_heart_RNA', 'MA25_heart_ATAC', 'MA25_heart_RNA', 'MA26_heart_ATAC', 'MA26_heart_RNA', 'MA27_heart_ATAC', 'MA27_heart_RNA', 'MA28_heart_ATAC', 'MA28_heart_RNA', 'MA29_heart_ATAC', 'MA29_heart_RNA', 'MA31_heart_ATAC', 'MA31_heart_RNA', 'MA32_heart_ATAC', 'MA32_heart_RNA', 'MA33_heart_ATAC', 'MA33_heart_RNA', 'MA5_heart_ATAC', 'MA5_heart_RNA', 'MA6_heart_ATAC', 'MA6_heart_RNA', 'MA7_heart_ATAC', 'MA7_heart_RNA', 'MA8_heart_ATAC', 'MA8_heart_RNA', 'MA9_heart_ATAC', 'MA9_heart_RNA']

Sample counts AFTER filtering:
sample
MA14_heart_RNA     4203
MA10_heart_RNA     4197
MA9_heart_RNA      4047
MA31_heart_ATAC    3611
MA29_heart_ATAC    3401
MA9_heart_ATAC     3096
MA10_heart_ATAC    3007
MA8_heart_RNA      2941
MA14_heart_ATAC    2657
MA31_heart_RNA     2610
MA33_heart_ATAC    2578
MA23_heart_ATAC    2561
MA19_heart_ATAC    2376
MA24_heart_ATAC    2343
MA8_heart_ATAC     2290
MA29_heart_RNA     2275
MA28_heart_ATAC    2093
MA22_heart_ATAC    1869
MA28_heart_RNA     1767
MA33_heart_RNA     1759
MA6_heart_RNA      1738
MA25_heart_ATAC    1656
MA11_heart_RNA     1653
MA19_heart_RNA     1514
MA27_heart_ATAC    1492
MA32_heart_ATAC    1475
MA6_heart_ATAC     1452
MA27_heart_RNA     1397
MA5_heart_RNA      1303
MA20_heart_ATAC    1282
MA5_heart_ATAC     1108
MA32_heart_RNA     1060
MA11_heart_ATAC    1050
MA26_heart_ATAC     991
MA24_heart_RNA      885
MA22_heart_RNA      777
MA23_heart_RNA      607
MA7_heart_RNA       440
MA13_heart_RNA      417
MA20_heart_RNA      340
MA7_heart_ATAC      331
MA25_heart_RNA      312
MA13_heart_ATAC     234
MA26_heart_RNA      223
Name: count, dtype: int64
Final filtering -- Cells remaining: 79418, Genes remaining: 16049
Preprocessing complete!
Preprocessed data saved to: /dcs07/hongkai/data/harry/result/multi_omics_heart/multiomics/preprocess/adata_sample.h5ad
Original sample IDs stored in: adata.obs['original_sample']
Function execution time: 19.96 seconds
✓ Integration preprocessing completed successfully
Loaded dimensionality reduction data from existing files

Pipeline completed successfully!
Results saved to: /dcs07/hongkai/data/harry/result/multi_omics_heart/multiomics
Available results: ['adata', 'atac_pseudobulk_df', 'pseudobulk_adata', 'status_flags']
Final status flags: {'glue_integration': True, 'glue_preprocessing': True, 'glue_training': True, 'glue_gene_activity': True, 'glue_cell_types': True, 'glue_visualization': True, 'integration_preprocessing': True, 'dimensionality_reduction': True, 'embedding_visualization': True, 'optimal_resolution': False}
Completed steps: 9/10
GLUE sub-steps completed: 5/5

✓ Multiomics pipeline completed successfully!

============================================================
PIPELINE EXECUTION SUMMARY
============================================================
Multiomics Pipeline: ⚠ PARTIAL
  - glue_integration: ✓
  - glue_preprocessing: ✓
  - glue_training: ✓
  - glue_gene_activity: ✓
  - glue_cell_types: ✓
  - glue_visualization: ✓
  - integration_preprocessing: ✓
  - dimensionality_reduction: ✓
  - embedding_visualization: ✓
  - optimal_resolution: ✗

Results saved to: /dcs07/hongkai/data/harry/result/multi_omics_heart
Status file: /dcs07/hongkai/data/harry/result/multi_omics_heart/sys_log/main_process_status.json
Execution time: 26.9258 seconds

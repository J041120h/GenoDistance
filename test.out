[Pipeline] Loading data...
  Cell data: (823700, 2000)
  Pseudobulk: (88, 2000)
  Pseudobulk samples: ['ENCSR033MDU_ATAC', 'ENCSR033MDU_RNA', 'ENCSR128ZLB_ATAC', 'ENCSR128ZLB_RNA', 'ENCSR158DQA_ATAC']...

[Pipeline] Extracting embeddings from pseudobulk...
  Found X_DR_expression: shape (88, 10)
  Found X_DR_proportion: shape (88, 10)

[Pipeline] Pseudobulk modalities:
  ATAC samples: 44
  RNA samples: 44
  Paired samples: 44

[Pipeline] Target features: 32 cell types, 2000 total genes

[Pipeline] Creating ATAC pseudobulk...
[Aggregate ATAC] Filtered to ATAC: 419524 cells
[Aggregate ATAC] Samples: 44, Cell types: 11
[Aggregate ATAC] Target features: 393
[Aggregate ATAC] Output shape: (44, 393)

[Pipeline] Creating RNA pseudobulk...
[Aggregate RNA] Filtered to RNA: 404176 cells
[Aggregate RNA] Samples: 44, Cell types: 22
[Aggregate RNA] Target features: 433
[Aggregate RNA] Output shape: (44, 433)

[Pipeline] Common features between ATAC and RNA: 103

[Pipeline] Matched samples:
  ATAC (cell-level -> multiomics pb): 44
  RNA (cell-level -> multiomics pb): 44
  ATAC expression matrix: (44, 103)
  RNA expression matrix: (44, 103)

======================================================================
CROSS-MODAL EMBEDDING EVALUATION
(For each ATAC sample, check correlation with nearest RNA sample)
======================================================================

  X_DR_expression:
    Avg correlation (nearest RNA):     -0.2828
    Avg correlation (k=1 nearest RNA): -0.2828
    Avg correlation (paired samples):  -0.2764
    Samples: 44 ATAC, 44 RNA, 44 paired

  X_DR_proportion:
    Avg correlation (nearest RNA):     -0.2646
    Avg correlation (k=1 nearest RNA): -0.2646
    Avg correlation (paired samples):  -0.2764
    Samples: 44 ATAC, 44 RNA, 44 paired

----------------------------------------------------------------------
BEST EMBEDDING: X_DR_proportion
  avg_nearest_rna_corr = -0.2646
======================================================================

[Pipeline] Saving results to /dcs07/hongkai/data/harry/result/multi_omics_SD/embedding_selection...

[Pipeline] Complete!
  Evaluation results: /dcs07/hongkai/data/harry/result/multi_omics_SD/embedding_selection/embedding_evaluation.csv
  Best embedding: X_DR_proportion

Best embedding: X_DR_proportion

Evaluation summary:
                 avg_nearest_rna_corr  avg_knn_corr  ...  n_rna_samples  n_paired
embedding                                            ...                         
X_DR_expression             -0.282799     -0.282799  ...             44        44
X_DR_proportion             -0.264551     -0.264551  ...             44        44

[2 rows x 6 columns]

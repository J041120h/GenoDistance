======================================
 Job ID:            17606631
 Job Name:          test
 Partition:         gpu
 Node List:         compute-170
 CPUs per Task:     16
 Memory Alloc:      819200
 GPU Requested:     1
 Start Time:        Fri Jun 20 01:59:08 AM EDT 2025
======================================
Checking GPU status...
Fri Jun 20 01:59:11 2025       
+-----------------------------------------------------------------------------------------+
| NVIDIA-SMI 555.42.06              Driver Version: 555.42.06      CUDA Version: 12.5     |
|-----------------------------------------+------------------------+----------------------+
| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |
| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |
|                                         |                        |               MIG M. |
|=========================================+========================+======================|
|   0  NVIDIA H100 NVL                Off |   00000000:D1:00.0 Off |                    0 |
| N/A   43C    P0             90W /  400W |       1MiB /  95830MiB |      3%      Default |
|                                         |                        |             Disabled |
+-----------------------------------------+------------------------+----------------------+
                                                                                         
+-----------------------------------------------------------------------------------------+
| Processes:                                                                              |
|  GPU   GI   CI        PID   Type   Process name                              GPU Memory |
|        ID   ID                                                               Usage      |
|=========================================================================================|
|  No running processes found                                                             |
+-----------------------------------------------------------------------------------------+
Starting main.py...
Start of Process

Resuming process from previous progress:
{
    "preprocessing": true,
    "cell_type_cluster": true,
    "sample_distance_calculation": true,
    "DimensionalityReduction": true,
    "trajectory_analysis": true,
    "visualize_data": true,
    "initialization": false
}
Linux system detected.


Enabling managed memory for RMM...


Processing X_DR_proportion...

The CCA score for X_DR_proportion is 0.3260

Saved CCA plot to: /dcl01/hongkai/data/data/hjiang/result/CCA/pca_2d_cca_proportion.pdf
Processing X_DR_expression...

The CCA score for X_DR_expression is 0.5741

Saved CCA plot to: /dcl01/hongkai/data/data/hjiang/result/CCA/pca_2d_cca_expression.pdf
CCA analysis completed.

[CCA] Total runtime: 0.51 seconds

P-value for observed correlation 0.32595302424938705: 0.318
[CCA p-test] Runtime: 0.90 seconds
P-value for observed correlation 0.5740778476438325: 0.005
[CCA p-test] Runtime: 0.88 seconds
Starting ATAC resolution optimization for X_DR_expression...
Using 48 threads
Using representation: X_DM_harmony with 20 components
Testing resolutions from 0.01 to 1.00...
[cell_types_atac] No cell type annotation found. Performing clustering.
[cell_types_atac] Building neighborhood graph...
[cell_types_atac] No cell type annotation found. Performing clustering.
[cell_types_atac] Building neighborhood graph...
[cell_types_atac] No cell type annotation found. Performing clustering.
[cell_types_atac] Building neighborhood graph...
[cell_types_atac] No cell type annotation found. Performing clustering.
[cell_types_atac] Building neighborhood graph...
[cell_types_atac] No cell type annotation found. Performing clustering.
[cell_types_atac] Building neighborhood graph...
[cell_types_atac] No cell type annotation found. Performing clustering.[cell_types_atac] No cell type annotation found. Performing clustering.
[cell_types_atac] Building neighborhood graph...

[cell_types_atac] Building neighborhood graph...
[cell_types_atac] No cell type annotation found. Performing clustering.
[cell_types_atac] Building neighborhood graph...
[cell_types_atac] No cell type annotation found. Performing clustering.
[cell_types_atac] Building neighborhood graph...
[cell_types_atac] No cell type annotation found. Performing clustering.
[cell_types_atac] Building neighborhood graph...
[cell_types_atac] No target clusters specified. Using standard Leiden clustering (resolution=0.30000000000000004)...[cell_types_atac] No target clusters specified. Using standard Leiden clustering (resolution=0.1)...

[cell_types_atac] No target clusters specified. Using standard Leiden clustering (resolution=0.6)...
[cell_types_atac] No target clusters specified. Using standard Leiden clustering (resolution=0.4)...
[cell_types_atac] No target clusters specified. Using standard Leiden clustering (resolution=0.7000000000000001)...
[cell_types_atac] No target clusters specified. Using standard Leiden clustering (resolution=0.2)...
[cell_types_atac] No target clusters specified. Using standard Leiden clustering (resolution=0.5)...
[cell_types_atac] No target clusters specified. Using standard Leiden clustering (resolution=0.9)...
[cell_types_atac] No target clusters specified. Using standard Leiden clustering (resolution=0.8)...
[cell_types_atac] No target clusters specified. Using standard Leiden clustering (resolution=1.0)...
[cell_types_atac] Found 7 clusters after Leiden clustering.
[cell_types_atac] Found 23 clusters after Leiden clustering.[cell_types_atac] Finished assigning cell types.

[cell_types_atac] Found 27 clusters after Leiden clustering.[cell_types_atac] Finished assigning cell types.
[cell_types_atac] Found 25 clusters after Leiden clustering.

[cell_types_atac] Finished assigning cell types.
[cell_types_atac] Found 10 clusters after Leiden clustering.
[cell_types_atac] Finished assigning cell types.
[cell_types_atac] Finished assigning cell types.
[cell_types_atac] Found 21 clusters after Leiden clustering.
[cell_types_atac] Finished assigning cell types.
[standardize] Converted categorical to string format
[standardize] Converted categorical to string format
[standardize] Converted categorical to string format
[cell_types_atac] Found 15 clusters after Leiden clustering.[standardize] Converted categorical to string format
[standardize] Converted categorical to string format[standardize] Final cell types (n=23): ['1', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '2', '20', '21', '22', '23', '3', '4', '5', '6', '7', '8', '9']


[cell_types_atac] Found 19 clusters after Leiden clustering.[cell_types_atac] Total runtime: 68.59 seconds

[cell_types_atac] Found 27 clusters after Leiden clustering.
[standardize] Final cell types (n=7): ['1', '2', '3', '4', '5', '6', '7']
[cell_types_atac] Total runtime: 68.21 seconds
[cell_types_atac] Finished assigning cell types.
[cell_types_atac] Finished assigning cell types.
[cell_types_atac] Finished assigning cell types.
[standardize] Final cell types (n=25): ['1', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '2', '20', '21', '22', '23', '24', '25', '3', '4', '5', '6', '7', '8', '9']
[cell_types_atac] Total runtime: 68.44 seconds
[standardize] Converted categorical to string format
[standardize] Final cell types (n=27): ['1', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '2', '20', '21', '22', '23', '24', '25', '26', '27', '3', '4', '5', '6', '7', '8', '9']
[cell_types_atac] Total runtime: 68.23 seconds
[standardize] Converted categorical to string format
[standardize] Converted categorical to string format
Processing 7 cell types across 24 samples
[standardize] Final cell types (n=10): ['1', '10', '2', '3', '4', '5', '6', '7', '8', '9']
[cell_types_atac] Total runtime: 68.26 seconds
Processing 23 cell types across 24 samples
Processing 25 cell types across 24 samples
[standardize] Converted categorical to string format
Processing 27 cell types across 24 samples[standardize] Final cell types (n=21): ['1', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '2', '20', '21', '3', '4', '5', '6', '7', '8', '9']
[cell_types_atac] Total runtime: 68.15 seconds
[standardize] Final cell types (n=27): ['1', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '2', '20', '21', '22', '23', '24', '25', '26', '27', '3', '4', '5', '6', '7', '8', '9']
[cell_types_atac] Total runtime: 68.29 seconds
Creating layer for 1

Processing 10 cell types across 24 samplesCreating layer for 1
Creating layer for 1

[standardize] Final cell types (n=15): ['1', '10', '11', '12', '13', '14', '15', '2', '3', '4', '5', '6', '7', '8', '9']
[cell_types_atac] Total runtime: 68.32 seconds
Processing 21 cell types across 24 samples[standardize] Final cell types (n=19): ['1', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '2', '3', '4', '5', '6', '7', '8', '9']
[cell_types_atac] Total runtime: 68.32 seconds

Processing 27 cell types across 24 samples
Creating layer for 1
Creating layer for 1
Creating layer for 1Processing 15 cell types across 24 samples
Creating layer for 1

Processing 19 cell types across 24 samples
Creating layer for 1
[cell_types_atac] Found 28 clusters after Leiden clustering.
[cell_types_atac] Finished assigning cell types.
Creating layer for 1
[standardize] Converted categorical to string format
[standardize] Final cell types (n=28): ['1', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '2', '20', '21', '22', '23', '24', '25', '26', '27', '28', '3', '4', '5', '6', '7', '8', '9']
[cell_types_atac] Total runtime: 68.57 seconds
Processing 28 cell types across 24 samples
Creating layer for 1
Creating layer for 10
Creating layer for 10
Creating layer for 10
Creating layer for 10
Creating layer for 11
Creating layer for 10
Creating layer for 10
Creating layer for 10
Creating layer for 11
Creating layer for 10
Creating layer for 12Creating layer for 11

Creating layer for 11
Creating layer for 10
Creating layer for 11
Creating layer for 12
Creating layer for 11
Creating layer for 12
Creating layer for 12
Creating layer for 11
Creating layer for 2
Creating layer for 13
Creating layer for 12
Creating layer for 13
Creating layer for 12
Creating layer for 11
Creating layer for 13
Creating layer for 14
Creating layer for 12
Creating layer for 13
Creating layer for 3
Creating layer for 13
Creating layer for 2
Creating layer for 15
Creating layer for 14
Creating layer for 13
Creating layer for 2
Creating layer for 14
Creating layer for 14
Creating layer for 12
Creating layer for 14
Creating layer for 4
Creating layer for 3
Creating layer for 13
Creating layer for 15
Creating layer for 15
Creating layer for 15
Creating layer for 15
Creating layer for 5
Creating layer for 3
Creating layer for 14
Creating layer for 13
Creating layer for 16
Creating layer for 16
Creating layer for 16
Creating layer for 14
Creating layer for 15
Creating layer for 14
Creating layer for 16
Creating layer for 17
Creating layer for 16
Creating layer for 4
Creating layer for 17
Creating layer for 6
Creating layer for 15
Creating layer for 17
Creating layer for 17
Creating layer for 15
Creating layer for 16
Creating layer for 18
Creating layer for 18
Creating layer for 16
Creating layer for 17
Creating layer for 18
Creating layer for 19
Creating layer for 18
Creating layer for 17
Creating layer for 19
Creating layer for 19
Creating layer for 18
Creating layer for 4
Creating layer for 5
Creating layer for 17
Creating layer for 19
Creating layer for 2
Creating layer for 2
Creating layer for 18
Creating layer for 2
Creating layer for 7
Creating layer for 18
Creating layer for 19
Creating layer for 20
Creating layer for 19
Creating layer for 5
Creating layer for 2
Creating layer for 2
Creating layer for 20
Creating layer for 2
Creating layer for 20
Creating layer for 21
Creating layer for 19
Creating layer for 21
Creating layer for 22
Creating layer for 6
Creating layer for 8
Creating layer for 21
Creating layer for 20
Creating layer for 22
Creating layer for 20
Creating layer for 23
Creating layer for 3
Creating layer for 22
Creating layer for 23
Creating layer for 21
Creating layer for 3
Creating layer for 24
Creating layer for 2
Creating layer for 23
Creating layer for 21
Creating layer for 3
Creating layer for 7
Creating layer for 24
Creating layer for 25
Creating layer for 4
Creating layer for 6
Creating layer for 4
Creating layer for 22
Creating layer for 3
Creating layer for 25
Creating layer for 7
Creating layer for 23
Creating layer for 20
Creating layer for 9
Creating layer for 4
Creating layer for 5
Creating layer for 26Creating layer for 5


Processing cell type: 1
Creating layer for 24
Creating layer for 8
Creating layer for 4

Processing cell type: 1
Creating layer for 21
  Selecting top 2000 HVGs
Creating layer for 6
  Selecting top 2000 HVGs
Creating layer for 27
  Selected 2000 HVGs

Processing cell type: 2
Creating layer for 5
Creating layer for 25
Creating layer for 5
Creating layer for 22
  Selected 2000 HVGs

Processing cell type: 10
Creating layer for 6
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
Creating layer for 3
  Selected 2000 HVGs

Processing cell type: 3
  Selected 2001 HVGsCreating layer for 9


Processing cell type: 2
Creating layer for 23
Creating layer for 7
  Selecting top 2000 HVGs
Creating layer for 6
  Selecting top 2000 HVGs
Creating layer for 6
  Selected 2000 HVGs

Processing cell type: 4
  Selected 2000 HVGs

Processing cell type: 3
Creating layer for 26
Creating layer for 7

Processing cell type: 1
Creating layer for 24
  Selecting top 2000 HVGs
Creating layer for 8
Creating layer for 4
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 5
Creating layer for 27
Creating layer for 7
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 4
  Selected 2000 HVGs

Processing cell type: 10
Creating layer for 25
Creating layer for 7
  Selected 2000 HVGs
  Selecting top 2000 HVGs
Processing cell type: 6

  Selecting top 2000 HVGs
Creating layer for 28
Creating layer for 5
Creating layer for 8
Creating layer for 8
Creating layer for 3
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 5
Creating layer for 26
  Selected 2003 HVGs

Processing cell type: 11
Creating layer for 8
Creating layer for 9
  Selected 2000 HVGs

Processing cell type: 7
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
Creating layer for 9
Creating layer for 6
Creating layer for 9
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 6
Creating layer for 4
  Selected 2006 HVGs

Processing cell type: 12
Creating layer for 27
  Selected 2026 HVGs

Concatenating all cell type HVGs into single AnnData
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
Creating layer for 3
Applying final HVG selection on 14026 concatenated genes
Creating layer for 7
Final HVG selection: 2000 genes

Creating final HVG expression matrix
  Selected 2000 HVGs

Processing cell type: 7
  Selected 2000 HVGs

Processing cell type: 13
Creating layer for 9
Creating layer for 5

Processing cell type: 1
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs

Processing cell type: 1

Processing cell type: 1
  Selecting top 2000 HVGs

Total runtime: 7.87 seconds
Final HVG matrix shape: (7, 24)
Final AnnData shape: (24, 2000)
  Selected 2000 HVGs

Processing cell type: 8
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 14
  Selecting top 2000 HVGs
Creating layer for 4Creating layer for 8


Processing cell type: 1
  Selected 2000 HVGs

Processing cell type: 10
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 10
  Selected 2000 HVGs

Processing cell type: 10
  Selecting top 2000 HVGs
Creating layer for 6
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 9
  Selected 2000 HVGs

Processing cell type: 15
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 10
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 11
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 11
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 11
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Concatenating all cell type HVGs into single AnnData
Applying final HVG selection on 20001 concatenated genes
  Selecting top 2000 HVGs
  Selected 2006 HVGs

Processing cell type: 2
Creating layer for 7
  Selected 2000 HVGs

Processing cell type: 11
Creating layer for 9
Creating layer for 5Final HVG selection: 2012 genes

Creating final HVG expression matrix

  Selected 2000 HVGs  Selected 2000 HVGs

Processing cell type: 12


Processing cell type: 12
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 12
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs

Processing cell type: 1
  Selected 2000 HVGs

Processing cell type: 12
  Selected 2000 HVGs

Processing cell type: 3
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 13
  Selected 2000 HVGs
  Selecting top 2000 HVGs
Processing cell type: 13

  Selected 2000 HVGs

Processing cell type: 13
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 13
  Selected 2000 HVGs

Processing cell type: 10
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 4

Total runtime: 9.73 seconds
Final HVG matrix shape: (10, 24)
Final AnnData shape: (24, 2012)
  Selecting top 2000 HVGsCreating layer for 6

Creating layer for 8
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 14
  Selecting top 2000 HVGs  Selected 2000 HVGs


Processing cell type: 14
  Selected 2000 HVGs

Processing cell type: 14
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 14
  Selected 2000 HVGs

Processing cell type: 11
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 5
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 15
  Selected 2000 HVGs

Processing cell type: 15
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 15
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
Creating layer for 7
  Selected 2000 HVGs

Processing cell type: 15
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 12
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 6
  Selected 2000 HVGs

Processing cell type: 16
  Selected 2000 HVGs

Processing cell type: 16
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 16
  Selecting top 2000 HVGsCreating layer for 9

  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 16
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 13
  Selected 2000 HVGs

Processing cell type: 17
  Selecting top 2000 HVGsCreating layer for 8

  Selected 2000 HVGs

Processing cell type: 7
  Selected 2000 HVGs

Processing cell type: 17
  Selecting top 2000 HVGs
[process_anndata_with_pca] Starting dimension reduction computation...
[process_anndata_with_pca] Results will be stored under unified keys:
  - X_DR_expression: for expression data
  - X_DR_proportion: for proportion data
[process_anndata_with_pca] RNA mode: Will use PCA for expression data
[process_anndata_with_pca] Using n_expression_pcs=10, n_proportion_pcs=7
[process_anndata_with_pca] Data dimensions: expression=(24, 2000), proportion=(24, 7)
[DimRed] Computing PCA for RNA data with 10 components on (24, 2000) data
  Selected 2000 HVGs

Processing cell type: 17
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
[PCA] Success. Shape: (24, 10)  Selecting top 2000 HVGs

[Storage] Stored X_DR_expression in both adata and pseudobulk_anndata (shape: (24, 10))
[Storage] Stored X_pca_expression_method in both adata and pseudobulk_anndata (shape: (24, 10))
[PCA] Stored variance information in both objects
[DimRed] Completed - results stored as X_DR_expression in both adata and pseudobulk_anndata
[process_anndata_with_pca] ✓ Expression dimension reduction completed successfully
[run_pca_proportion] PCA on cell proportions completed.
Stored results as X_DR_proportion in both adata and pseudobulk_anndata with shape: (24, 7)
[process_anndata_with_pca] ✓ Proportion dimension reduction completed successfully

[process_anndata_with_pca] === SUMMARY ===
Total runtime: 0.16 seconds
Expression dimension reduction: ✓ SUCCESS
Proportion dimension reduction: ✓ SUCCESS
Results available under unified keys:
  - X_DR_expression in both adata.uns and pseudobulk_anndata.uns
  - X_DR_proportion in both adata.uns and pseudobulk_anndata.uns
  Selected 2001 HVGs

Processing cell type: 17
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 14
  Selecting top 2000 HVGs  Selected 2000 HVGs


Processing cell type: 18
  Selected 2000 HVGs

Processing cell type: 18
  Selected 2000 HVGs

Processing cell type: 8
  Selecting top 2000 HVGs
Creating layer for 9
  Selected 2000 HVGs

Processing cell type: 18

Processing cell type: 1  Selecting top 2000 HVGs

  Selecting top 2000 HVGs
Resolution 0.10: CCA Score = 0.3572
  Selected 2000 HVGs

Processing cell type: 18
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs  Selecting top 2000 HVGs


Processing cell type: 15
  Selected 2001 HVGs

Processing cell type: 19

Processing cell type: 1
  Selected 2000 HVGs

Processing cell type: 19
  Selected 2000 HVGs

Processing cell type: 19
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 9
  Selecting top 2000 HVGs  Selecting top 2000 HVGs

  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 10
  Selected 2089 HVGs

Processing cell type: 19
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs  Selected 2000 HVGs

Processing cell type: 16


Processing cell type: 2
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 10
  Selected 2000 HVGs

Processing cell type: 2
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 2
  Selected 2000 HVGs

Processing cell type: 11
  Selected 2000 HVGs

Concatenating all cell type HVGs into single AnnData
  Selecting top 2000 HVGs
Applying final HVG selection on 30015 concatenated genes
  Selected 2000 HVGs

Processing cell type: 2
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 17
  Selected 2000 HVGs

Processing cell type: 20
Final HVG selection: 2000 genes

Creating final HVG expression matrix
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 11
  Selected 2000 HVGs

Processing cell type: 3
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 12
  Selected 2000 HVGs  Selecting top 2000 HVGs

Processing cell type: 20

  Selecting top 2000 HVGs
  Selected 2001 HVGs

Processing cell type: 20
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 21
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 18
  Selecting top 2000 HVGs
[process_anndata_with_pca] Starting dimension reduction computation...
[process_anndata_with_pca] Results will be stored under unified keys:
  - X_DR_expression: for expression data
  - X_DR_proportion: for proportion data
[process_anndata_with_pca] RNA mode: Will use PCA for expression data
[process_anndata_with_pca] Using n_expression_pcs=10, n_proportion_pcs=10
[process_anndata_with_pca] Data dimensions: expression=(24, 2012), proportion=(24, 10)
[DimRed] Computing PCA for RNA data with 10 components on (24, 2012) data
  Selected 2000 HVGs

Processing cell type: 4
  Selected 2000 HVGs

Processing cell type: 12
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 13
[PCA] Success. Shape: (24, 10)
[Storage] Stored X_DR_expression in both adata and pseudobulk_anndata (shape: (24, 10))
[Storage] Stored X_pca_expression_method in both adata and pseudobulk_anndata (shape: (24, 10))
  Selected 2000 HVGs[PCA] Stored variance information in both objects


Processing cell type: 21
[DimRed] Completed - results stored as X_DR_expression in both adata and pseudobulk_anndata
[process_anndata_with_pca] ✓ Expression dimension reduction completed successfully
[run_pca_proportion] PCA on cell proportions completed.
Stored results as X_DR_proportion in both adata and pseudobulk_anndata with shape: (24, 10)
[process_anndata_with_pca] ✓ Proportion dimension reduction completed successfully

[process_anndata_with_pca] === SUMMARY ===
Total runtime: 0.18 seconds
Expression dimension reduction: ✓ SUCCESS
Proportion dimension reduction: ✓ SUCCESS
Results available under unified keys:
  - X_DR_expression in both adata.uns and pseudobulk_anndata.uns
  - X_DR_proportion in both adata.uns and pseudobulk_anndata.uns
Resolution 0.20: CCA Score = 0.3562
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 21
  Selecting top 2000 HVGs
  Selected 2033 HVGs  Selecting top 2000 HVGs

Processing cell type: 19

  Selected 2001 HVGs

Processing cell type: 22
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 13
  Selected 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
Processing cell type: 5

  Selected 2000 HVGs

Processing cell type: 14
  Selected 2003 HVGs

Processing cell type: 22
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 3
  Selecting top 2000 HVGs
Resolution 0.30: Failed to compute score
  Selected 2003 HVGs

Processing cell type: 23
  Selected 2000 HVGs

Processing cell type: 2
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 14
  Selecting top 2000 HVGs
  Selected 2016 HVGs  Selecting top 2000 HVGs

Processing cell type: 6

  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 15
  Selected 2000 HVGs

Processing cell type: 23
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 4
  Selecting top 2000 HVGs
  Selected 2089 HVGs

Processing cell type: 3
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 20
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 15
  Selected 2000 HVGs

Processing cell type: 7
  Selecting top 2000 HVGs
  Selected 2010 HVGs

Processing cell type: 16
  Selected 2043 HVGs

Processing cell type: 24
  Selecting top 2000 HVGs
  Selected 2017 HVGs

Processing cell type: 4  Selecting top 2000 HVGs
  Selected 2000 HVGs


Processing cell type: 5
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 21
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 16
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2004 HVGs

Processing cell type: 8
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 17
  Selected 2000 HVGs

Processing cell type: 25
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 5
  Selected 2000 HVGs

Processing cell type: 6
  Selecting top 2000 HVGs  Selecting top 2000 HVGs

  Selected 2000 HVGs

Processing cell type: 22
  Selected 2000 HVGs
  Selecting top 2000 HVGs
Processing cell type: 17

  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 9
  Selected 2006 HVGs

Processing cell type: 3
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 18
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 6
  Selected 2018 HVGs

Processing cell type: 7
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 23
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs  Selected 2000 HVGs
  Selected 2000 HVGs

Concatenating all cell type HVGs into single AnnData


Processing cell type: 18
  Selecting top 2000 HVGs
Applying final HVG selection on 38020 concatenated genes
  Selected 2000 HVGs

Processing cell type: 4
  Selected 2000 HVGs

Processing cell type: 19
  Selecting top 2000 HVGs
Final HVG selection: 2000 genes

Creating final HVG expression matrix
  Selected 2000 HVGs

Processing cell type: 7
  Selected 2183 HVGs

Processing cell type: 8
  Selected 2000 HVGs

Processing cell type: 24
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 19
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 2
  Selected 2065 HVGs

Processing cell type: 5
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 8
  Selected 2007 HVGs

Processing cell type: 25
  Selected 2060 HVGs

Processing cell type: 9  Selecting top 2000 HVGs

  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 2
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 20
  Selected 2000 HVGs

Processing cell type: 6
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 9
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 26
  Selected 2000 HVGs  Selecting top 2000 HVGs

Concatenating all cell type HVGs into single AnnData

  Selecting top 2000 HVGs
Applying final HVG selection on 42261 concatenated genes
  Selecting top 2000 HVGs
Resolution 0.40: Failed to compute score
  Selected 2000 HVGs

Processing cell type: 20
  Selected 2000 HVGs

Processing cell type: 7
  Selected 2000 HVGs

Processing cell type: 21
Final HVG selection: 2000 genes

Creating final HVG expression matrix
  Selected 2000 HVGs

Concatenating all cell type HVGs into single AnnData
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs  Selecting top 2000 HVGs

Applying final HVG selection on 46111 concatenated genes
  Selected 2039 HVGs

Processing cell type: 27
Final HVG selection: 2000 genes

Creating final HVG expression matrix
  Selected 2003 HVGs

Processing cell type: 22
  Selected 2014 HVGs

Processing cell type: 8
  Selected 2000 HVGs

Processing cell type: 21
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 3
  Selected 2043 HVGs

Processing cell type: 23
  Selected 2000 HVGs  Selected 2000 HVGs

Processing cell type: 22


Processing cell type: 9
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 4
  Selected 2000 HVGs

Processing cell type: 24
  Selecting top 2000 HVGs
  Selected 2002 HVGs

Processing cell type: 23
  Selected 2002 HVGs

Concatenating all cell type HVGs into single AnnData
  Selecting top 2000 HVGs
Applying final HVG selection on 50224 concatenated genes
Resolution 0.50: Failed to compute score
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 5
Final HVG selection: 2000 genes

Creating final HVG expression matrix
  Selected 2000 HVGs

Processing cell type: 25
  Selected 2000 HVGs

Processing cell type: 24
Resolution 0.60: Failed to compute score
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 6
  Selected 2000 HVGs

Processing cell type: 26
  Selected 2000 HVGs

Processing cell type: 25
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
Resolution 0.70: Failed to compute score
  Selecting top 2000 HVGs
  Selected 2004 HVGs

Processing cell type: 7
  Selected 2006 HVGs

Processing cell type: 27
  Selected 2006 HVGs

Processing cell type: 26
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 8
  Selected 2010 HVGs

Processing cell type: 28
  Selected 2003 HVGs

Processing cell type: 27
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2089 HVGs

Processing cell type: 3
  Selected 2000 HVGs

Processing cell type: 9
  Selected 2102 HVGs

Processing cell type: 3
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2035 HVGs

Processing cell type: 4
  Selected 2066 HVGs

Concatenating all cell type HVGs into single AnnData
  Selecting top 2000 HVGs
Applying final HVG selection on 54149 concatenated genes
  Selected 2000 HVGs

Processing cell type: 4
Final HVG selection: 2075 genes

Creating final HVG expression matrix
  Selecting top 2000 HVGs
  Selected 2001 HVGs

Processing cell type: 5
  Selected 2000 HVGs

Processing cell type: 5
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 6
Resolution 0.80: Failed to compute score
  Selected 2000 HVGs

Processing cell type: 6
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2006 HVGs

Processing cell type: 7
  Selected 2005 HVGs

Processing cell type: 7
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 8
  Selected 2034 HVGs

Processing cell type: 8
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 9
  Selected 2054 HVGs

Processing cell type: 9
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Concatenating all cell type HVGs into single AnnData
Applying final HVG selection on 56203 concatenated genes
  Selected 2005 HVGs

Concatenating all cell type HVGs into single AnnData
Final HVG selection: 2000 genes

Creating final HVG expression matrix
Applying final HVG selection on 54211 concatenated genes
Final HVG selection: 2041 genes

Creating final HVG expression matrix
Resolution 1.00: Failed to compute score
Resolution 0.90: Failed to compute score

Best resolution from first pass: 0.10
Best CCA score: 0.3572

Fine-tuning search from 0.05 to 0.15...
Fine-tuned Resolution 0.050: Score 0.3402

Final best resolution: 0.050
Final best CCA score: 0.3402
Plot saved to: /dcl01/hongkai/data/data/hjiang/result/ATAC/CCA_test_atac/resolution_vs_cca_score_atac_X_DR_expression.png
Resolution scores saved to: /dcl01/hongkai/data/data/hjiang/result/ATAC/CCA_test_atac/resolution_scores_atac_X_DR_expression.csv

[Find Optimal Resolution ATAC] Total runtime: 166.47 seconds

Starting ATAC resolution optimization for X_DR_proportion...
Using 48 threads
Using representation: X_DM_harmony with 20 components
Testing resolutions from 0.01 to 1.00...
[cell_types_atac] No cell type annotation found. Performing clustering.
[cell_types_atac] Building neighborhood graph...
[cell_types_atac] No cell type annotation found. Performing clustering.
[cell_types_atac] Building neighborhood graph...
[cell_types_atac] No cell type annotation found. Performing clustering.
[cell_types_atac] Building neighborhood graph...
[cell_types_atac] No cell type annotation found. Performing clustering.
[cell_types_atac] Building neighborhood graph...
[cell_types_atac] No cell type annotation found. Performing clustering.
[cell_types_atac] Building neighborhood graph...
[cell_types_atac] No cell type annotation found. Performing clustering.
[cell_types_atac] Building neighborhood graph...
[cell_types_atac] No cell type annotation found. Performing clustering.
[cell_types_atac] Building neighborhood graph...
[cell_types_atac] No cell type annotation found. Performing clustering.
[cell_types_atac] Building neighborhood graph...
[cell_types_atac] No cell type annotation found. Performing clustering.
[cell_types_atac] Building neighborhood graph...
[cell_types_atac] No cell type annotation found. Performing clustering.
[cell_types_atac] Building neighborhood graph...
[cell_types_atac] No target clusters specified. Using standard Leiden clustering (resolution=0.4)...
[cell_types_atac] No target clusters specified. Using standard Leiden clustering (resolution=0.30000000000000004)...
[cell_types_atac] Found 19 clusters after Leiden clustering.
[cell_types_atac] Finished assigning cell types.
[standardize] Converted categorical to string format
[standardize] Final cell types (n=19): ['1', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '2', '3', '4', '5', '6', '7', '8', '9']
[cell_types_atac] Total runtime: 19.14 seconds
Processing 19 cell types across 24 samples
Creating layer for 1
[cell_types_atac] Found 15 clusters after Leiden clustering.
[cell_types_atac] Finished assigning cell types.
[standardize] Converted categorical to string format
[standardize] Final cell types (n=15): ['1', '10', '11', '12', '13', '14', '15', '2', '3', '4', '5', '6', '7', '8', '9']
[cell_types_atac] Total runtime: 21.68 seconds
Processing 15 cell types across 24 samples
Creating layer for 1
Creating layer for 10
Creating layer for 10
[cell_types_atac] No target clusters specified. Using standard Leiden clustering (resolution=0.7000000000000001)...
Creating layer for 11
[cell_types_atac] Found 25 clusters after Leiden clustering.
[cell_types_atac] Finished assigning cell types.
[standardize] Converted categorical to string format
[standardize] Final cell types (n=25): ['1', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '2', '20', '21', '22', '23', '24', '25', '3', '4', '5', '6', '7', '8', '9']
[cell_types_atac] Total runtime: 25.90 seconds
Processing 25 cell types across 24 samples
Creating layer for 1
Creating layer for 12
Creating layer for 11
Creating layer for 10
Creating layer for 13
Creating layer for 11
Creating layer for 14
Creating layer for 15
Creating layer for 12
Creating layer for 12
Creating layer for 2
Creating layer for 13
Creating layer for 14
Creating layer for 13
Creating layer for 3
Creating layer for 15
Creating layer for 16
Creating layer for 17
Creating layer for 14
Creating layer for 4
[cell_types_atac] No target clusters specified. Using standard Leiden clustering (resolution=0.8)...
Creating layer for 18
[cell_types_atac] No target clusters specified. Using standard Leiden clustering (resolution=0.6)...
[cell_types_atac] Found 27 clusters after Leiden clustering.
[cell_types_atac] Finished assigning cell types.
[standardize] Converted categorical to string format
[standardize] Final cell types (n=27): ['1', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '2', '20', '21', '22', '23', '24', '25', '26', '27', '3', '4', '5', '6', '7', '8', '9']
[cell_types_atac] Total runtime: 32.53 seconds
Processing 27 cell types across 24 samples
Creating layer for 1
[cell_types_atac] No target clusters specified. Using standard Leiden clustering (resolution=0.9)...
[cell_types_atac] Found 23 clusters after Leiden clustering.
[cell_types_atac] Finished assigning cell types.
[standardize] Converted categorical to string format
[standardize] Final cell types (n=23): ['1', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '2', '20', '21', '22', '23', '3', '4', '5', '6', '7', '8', '9']
[cell_types_atac] Total runtime: 35.98 seconds
Processing 23 cell types across 24 samples
Creating layer for 1
[cell_types_atac] Found 27 clusters after Leiden clustering.
[cell_types_atac] Finished assigning cell types.
[standardize] Converted categorical to string format
[standardize] Final cell types (n=27): ['1', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '2', '20', '21', '22', '23', '24', '25', '26', '27', '3', '4', '5', '6', '7', '8', '9']
[cell_types_atac] Total runtime: 39.19 seconds
Processing 27 cell types across 24 samples
Creating layer for 15
Creating layer for 1
[cell_types_atac] No target clusters specified. Using standard Leiden clustering (resolution=1.0)...
Creating layer for 19
[cell_types_atac] No target clusters specified. Using standard Leiden clustering (resolution=0.1)...
[cell_types_atac] Found 28 clusters after Leiden clustering.
[cell_types_atac] Finished assigning cell types.
[standardize] Converted categorical to string format
[standardize] Final cell types (n=28): ['1', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '2', '20', '21', '22', '23', '24', '25', '26', '27', '28', '3', '4', '5', '6', '7', '8', '9']
[cell_types_atac] Total runtime: 42.78 seconds
Processing 28 cell types across 24 samples
Creating layer for 1
[cell_types_atac] No target clusters specified. Using standard Leiden clustering (resolution=0.5)...
[cell_types_atac] Found 7 clusters after Leiden clustering.
[cell_types_atac] Finished assigning cell types.
[standardize] Converted categorical to string format
[standardize] Final cell types (n=7): ['1', '2', '3', '4', '5', '6', '7']
[cell_types_atac] Total runtime: 46.15 seconds
Processing 7 cell types across 24 samples
Creating layer for 5
Creating layer for 1
[cell_types_atac] Found 21 clusters after Leiden clustering.
[cell_types_atac] Finished assigning cell types.
[standardize] Converted categorical to string format
[standardize] Final cell types (n=21): ['1', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '2', '20', '21', '3', '4', '5', '6', '7', '8', '9']
[cell_types_atac] Total runtime: 48.87 seconds
Processing 21 cell types across 24 samples
Creating layer for 16
Creating layer for 1
Creating layer for 2
Creating layer for 10
[cell_types_atac] No target clusters specified. Using standard Leiden clustering (resolution=0.2)...
Creating layer for 10Creating layer for 10

[cell_types_atac] Found 10 clusters after Leiden clustering.
[cell_types_atac] Finished assigning cell types.
[standardize] Converted categorical to string format
[standardize] Final cell types (n=10): ['1', '10', '2', '3', '4', '5', '6', '7', '8', '9']
[cell_types_atac] Total runtime: 51.81 seconds
Processing 10 cell types across 24 samples
Creating layer for 1
Creating layer for 17
Creating layer for 10
Creating layer for 10
Creating layer for 11Creating layer for 3

Creating layer for 18
Creating layer for 11
Creating layer for 11
Creating layer for 11
Creating layer for 12
Creating layer for 19
Creating layer for 6
Creating layer for 12
Creating layer for 11Creating layer for 4

Creating layer for 12
Creating layer for 10
Creating layer for 12
Creating layer for 2
Creating layer for 13
Creating layer for 13
Creating layer for 20
Creating layer for 12
Creating layer for 2
Creating layer for 5
Creating layer for 13
Creating layer for 7
Creating layer for 21
Creating layer for 6
Creating layer for 2
Creating layer for 13
Creating layer for 14
Creating layer for 22
Creating layer for 14
Creating layer for 13
Creating layer for 3
Creating layer for 15
Creating layer for 7
Creating layer for 23
Creating layer for 14
Creating layer for 15
Creating layer for 14
Creating layer for 3
Creating layer for 8
Creating layer for 24
Creating layer for 15
Creating layer for 16
Creating layer for 8
Creating layer for 15
Creating layer for 14
Creating layer for 4
Creating layer for 16
Creating layer for 16
Creating layer for 25
Creating layer for 17
Creating layer for 16
Creating layer for 3
Creating layer for 15
Creating layer for 5
Creating layer for 9
Creating layer for 17
Creating layer for 16
Creating layer for 9
Creating layer for 17
Creating layer for 17

Processing cell type: 1
Creating layer for 18
Creating layer for 4
Creating layer for 18
  Selecting top 2000 HVGs
Creating layer for 17
Creating layer for 18
Creating layer for 6
Creating layer for 19
  Selected 2000 HVGs

Processing cell type: 10
Creating layer for 18
Creating layer for 5
Creating layer for 19

Processing cell type: 1
  Selecting top 2000 HVGs
Creating layer for 18
Creating layer for 19
  Selecting top 2000 HVGs
  Selected 2003 HVGs

Processing cell type: 11
Creating layer for 4
Creating layer for 2
  Selected 2000 HVGsCreating layer for 19

Processing cell type: 10

  Selecting top 2000 HVGs
Creating layer for 2
Creating layer for 6
Creating layer for 19
  Selecting top 2000 HVGs
  Selected 2006 HVGs

Processing cell type: 12
  Selected 2000 HVGs

Processing cell type: 11
  Selecting top 2000 HVGs
Creating layer for 2
Creating layer for 2
  Selecting top 2000 HVGs
Creating layer for 20
Creating layer for 5
Creating layer for 7
  Selected 2000 HVGs

Processing cell type: 13
Creating layer for 20
Creating layer for 2
Creating layer for 7
  Selected 2000 HVGs

Processing cell type: 12
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
Creating layer for 21
Creating layer for 21
  Selected 2000 HVGs

Processing cell type: 14
Creating layer for 20
Creating layer for 8
  Selected 2000 HVGs

Processing cell type: 13
  Selecting top 2000 HVGs
Creating layer for 20
Creating layer for 22
Creating layer for 22
Creating layer for 20
  Selecting top 2000 HVGs
Creating layer for 21
  Selected 2000 HVGs

Processing cell type: 15
Creating layer for 8
  Selected 2000 HVGs

Processing cell type: 14
Creating layer for 23
  Selecting top 2000 HVGs
Creating layer for 3
Creating layer for 3
Creating layer for 23
  Selecting top 2000 HVGs
  Selected 2006 HVGs

Processing cell type: 2
Creating layer for 9
Creating layer for 21
  Selected 2000 HVGs

Processing cell type: 15
Creating layer for 21
  Selecting top 2000 HVGs
Creating layer for 24
  Selecting top 2000 HVGs
Creating layer for 4
Creating layer for 22
  Selected 2000 HVGs

Processing cell type: 3
Creating layer for 6
  Selected 2000 HVGs

Processing cell type: 16

Processing cell type: 1Creating layer for 22

Creating layer for 25
  Selecting top 2000 HVGs
Creating layer for 4
Creating layer for 23
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 4
Creating layer for 23
Creating layer for 7
  Selected 2000 HVGs

Processing cell type: 17
Creating layer for 26
  Selected 2000 HVGs

Processing cell type: 10
  Selecting top 2000 HVGs
Creating layer for 9
Creating layer for 5
Creating layer for 24
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 5

Processing cell type: 1
Creating layer for 5
Creating layer for 24
Creating layer for 27
  Selected 2000 HVGs

Processing cell type: 18
  Selected 2000 HVGs

Processing cell type: 11
  Selecting top 2000 HVGs

Processing cell type: 1
  Selecting top 2000 HVGs
Creating layer for 25
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 6
  Selected 2000 HVGs

Processing cell type: 2
Creating layer for 6
  Selected 2000 HVGs

Processing cell type: 19
Creating layer for 3
Creating layer for 25
  Selected 2000 HVGs

Processing cell type: 10
  Selecting top 2000 HVGs  Selected 2000 HVGs


Processing cell type: 12
  Selecting top 2000 HVGs
Creating layer for 26
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
Creating layer for 6
  Selected 2000 HVGs

Processing cell type: 7
  Selected 2000 HVGs

Processing cell type: 3
  Selected 2000 HVGs

Processing cell type: 2
  Selected 2001 HVGs

Processing cell type: 2
  Selected 2000 HVGs

Processing cell type: 13
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
Creating layer for 27
Creating layer for 3
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGsCreating layer for 4

  Selected 2000 HVGs

Processing cell type: 8
  Selected 2000 HVGs

Processing cell type: 4
Creating layer for 7
Creating layer for 7
  Selected 2000 HVGs

Processing cell type: 3
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 3
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 14
Creating layer for 26
Creating layer for 8
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs  Selecting top 2000 HVGs

  Selected 2000 HVGs

Processing cell type: 9
  Selected 2000 HVGs

Processing cell type: 5
Creating layer for 4
Creating layer for 5
  Selected 2000 HVGs

Processing cell type: 4
  Selecting top 2000 HVGs
Creating layer for 27
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 15
  Selected 2000 HVGs

Processing cell type: 4
  Selecting top 2000 HVGs
Creating layer for 9
  Selected 2000 HVGs  Selecting top 2000 HVGs

Concatenating all cell type HVGs into single AnnData

  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 6
Applying final HVG selection on 30015 concatenated genes
Creating layer for 8
  Selected 2000 HVGs

Processing cell type: 5
Creating layer for 28
  Selecting top 2000 HVGs
Creating layer for 6
  Selected 2000 HVGsFinal HVG selection: 2000 genes

Processing cell type: 5


Creating final HVG expression matrix
  Selected 2000 HVGs

Processing cell type: 16
  Selecting top 2000 HVGs
Creating layer for 3
  Selected 2000 HVGs

Processing cell type: 7
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
Creating layer for 7
Creating layer for 5
  Selected 2000 HVGs

Processing cell type: 6
Creating layer for 9
  Selecting top 2000 HVGs
  Selected 2016 HVGs

Processing cell type: 6
  Selected 2001 HVGs

Processing cell type: 17
  Selecting top 2000 HVGs

Processing cell type: 1
  Selected 2026 HVGs

Concatenating all cell type HVGs into single AnnData
Applying final HVG selection on 14026 concatenated genes
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
Creating layer for 4
  Selecting top 2000 HVGs
Final HVG selection: 2000 genes

Creating final HVG expression matrix
  Selected 2000 HVGs

Processing cell type: 7
  Selected 2000 HVGs

Processing cell type: 18
  Selected 2000 HVGs

Processing cell type: 7
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 10
  Selecting top 2000 HVGs
Creating layer for 8
  Selecting top 2000 HVGs
Creating layer for 6
  Selecting top 2000 HVGs

Total runtime: 38.23 seconds
Final HVG matrix shape: (15, 24)
Final AnnData shape: (24, 2000)
  Selected 2000 HVGs

Processing cell type: 8
Creating layer for 5

Processing cell type: 1
  Selected 2089 HVGs

Processing cell type: 19
  Selected 2004 HVGs

Processing cell type: 8

Total runtime: 14.13 seconds
Final HVG matrix shape: (7, 24)
Final AnnData shape: (24, 2000)
  Selected 2000 HVGs

Processing cell type: 11
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 9
Creating layer for 7
  Selected 2000 HVGs

Processing cell type: 10
  Selected 2000 HVGs

Processing cell type: 9
  Selected 2000 HVGs

Processing cell type: 2
  Selecting top 2000 HVGs
Creating layer for 6
  Selected 2000 HVGs

Processing cell type: 12
Creating layer for 9
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Concatenating all cell type HVGs into single AnnData
Applying final HVG selection on 20001 concatenated genes
  Selected 2000 HVGs

Processing cell type: 11
  Selected 2000 HVGs

Concatenating all cell type HVGs into single AnnData
Final HVG selection: 2012 genes

Creating final HVG expression matrix
  Selected 2001 HVGs

Processing cell type: 20
Creating layer for 8
  Selected 2000 HVGs

Processing cell type: 13

Processing cell type: 1
Applying final HVG selection on 38020 concatenated genes
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
Final HVG selection: 2000 genes

Creating final HVG expression matrix
Creating layer for 7
  Selected 2000 HVGs

Processing cell type: 12
  Selected 2000 HVGs

Processing cell type: 14
  Selected 2000 HVGs

Processing cell type: 21
  Selected 2000 HVGs

Processing cell type: 10
  Selecting top 2000 HVGs
Creating layer for 9
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 13
  Selected 2003 HVGs

Processing cell type: 22
  Selected 2000 HVGs
Processing cell type: 1


Processing cell type: 15
  Selected 2000 HVGs

Processing cell type: 11
  Selecting top 2000 HVGs

Total runtime: 10.66 seconds
Final HVG matrix shape: (10, 24)
Final AnnData shape: (24, 2012)
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 14
Creating layer for 8
  Selected 2000 HVGs

Processing cell type: 16
  Selected 2000 HVGs

Processing cell type: 12
  Selected 2000 HVGs

Processing cell type: 23
  Selected 2000 HVGs

Processing cell type: 10
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 15
  Selected 2000 HVGs

Processing cell type: 17
  Selected 2000 HVGs

Processing cell type: 13
  Selected 2043 HVGs

Processing cell type: 24
  Selected 2000 HVGs

Processing cell type: 11
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs

Total runtime: 44.39 seconds
Final HVG matrix shape: (19, 24)
Final AnnData shape: (24, 2000)
  Selected 2000 HVGs

Processing cell type: 16
  Selected 2000 HVGs

Processing cell type: 18
  Selected 2000 HVGs

Processing cell type: 12
  Selected 2000 HVGs

Processing cell type: 14
  Selected 2000 HVGs

Processing cell type: 25
Creating layer for 9
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 17
  Selected 2006 HVGs

Processing cell type: 3
[process_anndata_with_pca] Starting dimension reduction computation...
[process_anndata_with_pca] Results will be stored under unified keys:
  - X_DR_expression: for expression data
  - X_DR_proportion: for proportion data
[process_anndata_with_pca] RNA mode: Will use PCA for expression data
[process_anndata_with_pca] Using n_expression_pcs=10, n_proportion_pcs=10
[process_anndata_with_pca] Data dimensions: expression=(24, 2000), proportion=(24, 15)
[DimRed] Computing PCA for RNA data with 10 components on (24, 2000) data
  Selected 2000 HVGs

Processing cell type: 13
  Selected 2000 HVGs

Processing cell type: 15
  Selected 2000 HVGs

Processing cell type: 19
  Selecting top 2000 HVGs
[PCA] Success. Shape: (24, 10)
[Storage] Stored X_DR_expression in both adata and pseudobulk_anndata (shape: (24, 10))
[Storage] Stored X_pca_expression_method in both adata and pseudobulk_anndata (shape: (24, 10))
[PCA] Stored variance information in both objects
[DimRed] Completed - results stored as X_DR_expression in both adata and pseudobulk_anndata
[process_anndata_with_pca] ✓ Expression dimension reduction completed successfully
[run_pca_proportion] PCA on cell proportions completed.
Stored results as X_DR_proportion in both adata and pseudobulk_anndata with shape: (24, 10)
[process_anndata_with_pca] ✓ Proportion dimension reduction completed successfully

[process_anndata_with_pca] === SUMMARY ===
Total runtime: 0.16 seconds
Expression dimension reduction: ✓ SUCCESS
Proportion dimension reduction: ✓ SUCCESS
Results available under unified keys:
  - X_DR_expression in both adata.uns and pseudobulk_anndata.uns
  - X_DR_proportion in both adata.uns and pseudobulk_anndata.uns
  Selecting top 2000 HVGs
Resolution 0.30: CCA Score = 0.2959
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
[process_anndata_with_pca] Starting dimension reduction computation...
[process_anndata_with_pca] Results will be stored under unified keys:
  - X_DR_expression: for expression data
  - X_DR_proportion: for proportion data
[process_anndata_with_pca] RNA mode: Will use PCA for expression data
[process_anndata_with_pca] Using n_expression_pcs=10, n_proportion_pcs=7
[process_anndata_with_pca] Data dimensions: expression=(24, 2000), proportion=(24, 7)
[DimRed] Computing PCA for RNA data with 10 components on (24, 2000) data
[PCA] Success. Shape: (24, 10)
[Storage] Stored X_DR_expression in both adata and pseudobulk_anndata (shape: (24, 10))
[Storage] Stored X_pca_expression_method in both adata and pseudobulk_anndata (shape: (24, 10))
[PCA] Stored variance information in both objects
[DimRed] Completed - results stored as X_DR_expression in both adata and pseudobulk_anndata
[process_anndata_with_pca] ✓ Expression dimension reduction completed successfully
  Selected 2000 HVGs[run_pca_proportion] PCA on cell proportions completed.
Stored results as X_DR_proportion in both adata and pseudobulk_anndata with shape: (24, 7)
[process_anndata_with_pca] ✓ Proportion dimension reduction completed successfully

[process_anndata_with_pca] === SUMMARY ===
Total runtime: 0.07 seconds


Processing cell type: 18
Expression dimension reduction: ✓ SUCCESS
Proportion dimension reduction: ✓ SUCCESS
Results available under unified keys:
  - X_DR_expression in both adata.uns and pseudobulk_anndata.uns
  - X_DR_proportion in both adata.uns and pseudobulk_anndata.uns
Resolution 0.10: CCA Score = 0.2805
  Selected 2000 HVGs

Processing cell type: 16
  Selected 2000 HVGs

Processing cell type: 4
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 2

Processing cell type: 1
  Selected 2000 HVGs

Processing cell type: 14
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2001 HVGs

Processing cell type: 19
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 17
  Selected 2000 HVGs  Selecting top 2000 HVGs

Processing cell type: 20

  Selected 2000 HVGs

Processing cell type: 10
  Selected 2065 HVGs

Processing cell type: 5
  Selected 2000 HVGs

Processing cell type: 15
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 2
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 18
  Selected 2000 HVGs

Processing cell type: 21
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 6
  Selecting top 2000 HVGs  Selected 2000 HVGs

Processing cell type: 11

  Selected 2000 HVGs

Processing cell type: 16
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 20
  Selected 2033 HVGs

Processing cell type: 19
  Selected 2000 HVGs

Processing cell type: 3
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 7
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 12
  Selected 2000 HVGs

Processing cell type: 17
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs[process_anndata_with_pca] Starting dimension reduction computation...
[process_anndata_with_pca] Results will be stored under unified keys:
  - X_DR_expression: for expression data

  - X_DR_proportion: for proportion data
[process_anndata_with_pca] RNA mode: Will use PCA for expression data
[process_anndata_with_pca] Using n_expression_pcs=10, n_proportion_pcs=10
[process_anndata_with_pca] Data dimensions: expression=(24, 2012), proportion=(24, 10)
[DimRed] Computing PCA for RNA data with 10 components on (24, 2012) data
  Selected 2000 HVGs

Processing cell type: 21
  Selected 2000 HVGs

Processing cell type: 2
  Selected 2000 HVGs

Processing cell type: 4
[PCA] Success. Shape: (24, 10)
[Storage] Stored X_DR_expression in both adata and pseudobulk_anndata (shape: (24, 10))
[Storage] Stored X_pca_expression_method in both adata and pseudobulk_anndata (shape: (24, 10))
[PCA] Stored variance information in both objects
[DimRed] Completed - results stored as X_DR_expression in both adata and pseudobulk_anndata
[process_anndata_with_pca] ✓ Expression dimension reduction completed successfully
[run_pca_proportion] PCA on cell proportions completed.
Stored results as X_DR_proportion in both adata and pseudobulk_anndata with shape: (24, 10)
[process_anndata_with_pca] ✓ Proportion dimension reduction completed successfully

[process_anndata_with_pca] === SUMMARY ===
Total runtime: 0.17 seconds
Expression dimension reduction: ✓ SUCCESS
Proportion dimension reduction: ✓ SUCCESS
Results available under unified keys:
  - X_DR_expression in both adata.uns and pseudobulk_anndata.uns
  - X_DR_proportion in both adata.uns and pseudobulk_anndata.uns
Resolution 0.20: CCA Score = 0.2516
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs  Selected 2014 HVGs

Processing cell type: 8

  Selected 2000 HVGs

Processing cell type: 18
  Selected 2000 HVGs

Processing cell type: 13
  Selecting top 2000 HVGs
  Selected 2001 HVGs

Processing cell type: 22  Selecting top 2000 HVGs

  Selected 2000 HVGs

Processing cell type: 20
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 5
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 9
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 19
  Selected 2000 HVGs

Processing cell type: 14
  Selecting top 2000 HVGs
  Selected 2003 HVGs

Processing cell type: 23
  Selected 2000 HVGs

Processing cell type: 21
  Selecting top 2000 HVGs
[process_anndata_with_pca] Starting dimension reduction computation...
  Selecting top 2000 HVGs[process_anndata_with_pca] Results will be stored under unified keys:

  - X_DR_expression: for expression data
  - X_DR_proportion: for proportion data
[process_anndata_with_pca] RNA mode: Will use PCA for expression data
[process_anndata_with_pca] Using n_expression_pcs=10, n_proportion_pcs=10
[process_anndata_with_pca] Data dimensions: expression=(24, 2000), proportion=(24, 19)
[DimRed] Computing PCA for RNA data with 10 components on (24, 2000) data
  Selected 2000 HVGs

Processing cell type: 6
  Selecting top 2000 HVGs
[PCA] Success. Shape: (24, 10)
[Storage] Stored X_DR_expression in both adata and pseudobulk_anndata (shape: (24, 10))
[Storage] Stored X_pca_expression_method in both adata and pseudobulk_anndata (shape: (24, 10))
[PCA] Stored variance information in both objects
[DimRed] Completed - results stored as X_DR_expression in both adata and pseudobulk_anndata
[process_anndata_with_pca] ✓ Expression dimension reduction completed successfully
[run_pca_proportion] PCA on cell proportions completed.
Stored results as X_DR_proportion in both adata and pseudobulk_anndata with shape: (24, 10)
[process_anndata_with_pca] ✓ Proportion dimension reduction completed successfully

[process_anndata_with_pca] === SUMMARY ===
Total runtime: 0.08 seconds
Expression dimension reduction: ✓ SUCCESS
Proportion dimension reduction: ✓ SUCCESS
Results available under unified keys:
  - X_DR_expression in both adata.uns and pseudobulk_anndata.uns
  - X_DR_proportion in both adata.uns and pseudobulk_anndata.uns
Resolution 0.40: CCA Score = 0.0968
  Selecting top 2000 HVGs
  Selected 2002 HVGs

Concatenating all cell type HVGs into single AnnData
  Selecting top 2000 HVGs
Applying final HVG selection on 50224 concatenated genes
  Selected 2000 HVGs

Processing cell type: 2
  Selected 2000 HVGs

Processing cell type: 15
  Selected 2089 HVGs

Processing cell type: 3
  Selected 2000 HVGs

Processing cell type: 22
Final HVG selection: 2000 genes

Creating final HVG expression matrix
  Selected 2018 HVGs

Processing cell type: 7
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2017 HVGs

Processing cell type: 4
  Selected 2000 HVGs

Processing cell type: 20
  Selected 2010 HVGs

Processing cell type: 16
  Selected 2000 HVGs

Processing cell type: 23
  Selected 2183 HVGs
  Selecting top 2000 HVGs
Processing cell type: 8

  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 21
  Selected 2000 HVGs

Processing cell type: 5
  Selected 2000 HVGs

Processing cell type: 17
  Selected 2000 HVGs

Processing cell type: 24
Resolution 0.70: Failed to compute score
  Selected 2060 HVGs

Processing cell type: 9
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 22
  Selected 2000 HVGs

Processing cell type: 6
  Selected 2000 HVGs

Processing cell type: 18
  Selected 2007 HVGs  Selected 2000 HVGs

Concatenating all cell type HVGs into single AnnData


Processing cell type: 25
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
Applying final HVG selection on 42261 concatenated genes
Final HVG selection: 2000 genes

Creating final HVG expression matrix
  Selected 2000 HVGs

Processing cell type: 19
  Selecting top 2000 HVGs
  Selected 2002 HVGs

Processing cell type: 23
  Selected 2000 HVGs

Processing cell type: 7
  Selected 2000 HVGs

Processing cell type: 26
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 24
  Selected 2000 HVGs

Processing cell type: 8
  Selected 2000 HVGs

Processing cell type: 2
Resolution 0.50: Failed to compute score
  Selecting top 2000 HVGs
  Selected 2039 HVGs

Processing cell type: 27
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 25
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 9
  Selected 2000 HVGs

Processing cell type: 20
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 3
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2006 HVGs

Processing cell type: 26
  Selected 2000 HVGs
  Selecting top 2000 HVGs
Concatenating all cell type HVGs into single AnnData

  Selecting top 2000 HVGs
Applying final HVG selection on 46111 concatenated genes
  Selected 2000 HVGs

Processing cell type: 21
  Selected 2000 HVGs

Processing cell type: 4
Final HVG selection: 2000 genes

Creating final HVG expression matrix
  Selected 2003 HVGs

Processing cell type: 27
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2003 HVGs

Processing cell type: 22
  Selected 2000 HVGs

Processing cell type: 5
  Selected 2102 HVGs

Processing cell type: 3
Resolution 0.60: Failed to compute score
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2043 HVGs

Processing cell type: 23
  Selected 2000 HVGs

Processing cell type: 6
  Selected 2000 HVGs

Processing cell type: 4
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2004 HVGs

Processing cell type: 7
  Selected 2000 HVGs

Processing cell type: 24
  Selected 2000 HVGs

Processing cell type: 5
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 8
  Selected 2000 HVGs

Processing cell type: 25
  Selected 2000 HVGs

Processing cell type: 6
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 9
  Selected 2005 HVGs

Processing cell type: 7
  Selected 2000 HVGs

Processing cell type: 26
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2066 HVGs

Concatenating all cell type HVGs into single AnnData  Selected 2034 HVGs

Processing cell type: 8

  Selected 2006 HVGs

Processing cell type: 27
Applying final HVG selection on 54149 concatenated genes  Selecting top 2000 HVGs

Final HVG selection: 2075 genes

Creating final HVG expression matrix
  Selecting top 2000 HVGs
  Selected 2054 HVGs

Processing cell type: 9
  Selected 2010 HVGs

Processing cell type: 28
  Selecting top 2000 HVGs
  Selecting top 2000 HVGs
  Selected 2005 HVGs

Concatenating all cell type HVGs into single AnnData
Applying final HVG selection on 54211 concatenated genes
  Selected 2089 HVGs

Processing cell type: 3
Resolution 0.80: Failed to compute score
Final HVG selection: 2041 genes

Creating final HVG expression matrix
  Selecting top 2000 HVGs
  Selected 2035 HVGs

Processing cell type: 4
Resolution 0.90: Failed to compute score
  Selecting top 2000 HVGs
  Selected 2001 HVGs

Processing cell type: 5
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 6
  Selecting top 2000 HVGs
  Selected 2006 HVGs

Processing cell type: 7
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 8
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Processing cell type: 9
  Selecting top 2000 HVGs
  Selected 2000 HVGs

Concatenating all cell type HVGs into single AnnData
Applying final HVG selection on 56203 concatenated genes
Final HVG selection: 2000 genes

Creating final HVG expression matrix
Resolution 1.00: Failed to compute score

Best resolution from first pass: 0.30
Best CCA score: 0.2959

Fine-tuning search from 0.25 to 0.35...
Fine-tuned Resolution 0.320: Score 0.3078

Final best resolution: 0.320
Final best CCA score: 0.3078
Plot saved to: /dcl01/hongkai/data/data/hjiang/result/ATAC/CCA_test_atac/resolution_vs_cca_score_atac_X_DR_proportion.png
Resolution scores saved to: /dcl01/hongkai/data/data/hjiang/result/ATAC/CCA_test_atac/resolution_scores_atac_X_DR_proportion.csv

[Find Optimal Resolution ATAC] Total runtime: 157.27 seconds

End of Process

Finished main.py.
End Time: Fri Jun 20 02:07:33 AM EDT 2025

================================================================================
DIRECT HDF5 PROCESSING (Robust Version) ‚Äî DEBUG BUILD
================================================================================
[debug] Timestamp       : 2025-10-20T12:51:29.175592
[debug] integrated_path : /dcs07/hongkai/data/harry/result/all/multiomics/preprocess/atac_rna_integrated.h5ad
[debug] output_dir      : /dcs07/hongkai/data/harry/result/all/validation_results_pseudorna
[debug] batch_size      : 100
[debug] subsample_ratio : 0.1
[debug] max_memory_gb   : 400.0
[debug] debug           : True
================================================================================
DIRECT HDF5 PROCESSING (Robust Version)
================================================================================

üìÇ Processing: /dcs07/hongkai/data/harry/result/all/multiomics/preprocess/atac_rna_integrated.h5ad
   Batch size: 100
   Subsample ratio: 0.1
   Max memory: 400.0 GB
[debug] Wrote h5_structure.txt
[debug] matrix_shape: (861190, 36601)
[debug] n_genes     : 36601
[debug] Wrote obs_preview.csv (first 50 rows).
[debug] Wrote obs_value_counts_modality.csv
   Matrix shape: (861190, 36601)
   RNA cells: 430595
   ATAC cells: 430595
[debug] RNA cells : 430595
[debug] ATAC cells: 430595

[DEBUG] RNA index examples: ['ENCSR212VKB_AAACAGCCAAAGGTAC-1_RNA', 'ENCSR212VKB_AAACAGCCAACAGGAT-1_RNA', 'ENCSR212VKB_AAACAGCCACAACAAA-1_RNA', 'ENCSR212VKB_AAACAGCCACATTGCA-1_RNA', 'ENCSR212VKB_AAACAGCCACCAGCAT-1_RNA', 'ENCSR212VKB_AAACAGCCAGCACGTT-1_RNA', 'ENCSR212VKB_AAACATGCAATTAGCT-1_RNA', 'ENCSR212VKB_AAACATGCACCCTCAC-1_RNA', 'ENCSR212VKB_AAACATGCATAAGCAA-1_RNA', 'ENCSR212VKB_AAACATGCATAGCTTG-1_RNA']
[DEBUG] ATAC index examples: ['adrenal_gland_ENCSR212VKB_AAACAGCCAAAGGTAC-1_ATAC', 'adrenal_gland_ENCSR212VKB_AAACAGCCAACAGGAT-1_ATAC', 'adrenal_gland_ENCSR212VKB_AAACAGCCACAACAAA-1_ATAC', 'adrenal_gland_ENCSR212VKB_AAACAGCCACATTGCA-1_ATAC', 'adrenal_gland_ENCSR212VKB_AAACAGCCACCAGCAT-1_ATAC', 'adrenal_gland_ENCSR212VKB_AAACAGCCAGCACGTT-1_ATAC', 'adrenal_gland_ENCSR212VKB_AAACATGCAATTAGCT-1_ATAC', 'adrenal_gland_ENCSR212VKB_AAACATGCACCCTCAC-1_ATAC', 'adrenal_gland_ENCSR212VKB_AAACATGCATAAGCAA-1_ATAC', 'adrenal_gland_ENCSR212VKB_AAACATGCATAGCTTG-1_ATAC']
[DEBUG] RNA original_barcode examples: ['ENCSR212VKB_AAACAGCCAAAGGTAC-1', 'ENCSR212VKB_AAACAGCCAACAGGAT-1', 'ENCSR212VKB_AAACAGCCACAACAAA-1', 'ENCSR212VKB_AAACAGCCACATTGCA-1', 'ENCSR212VKB_AAACAGCCACCAGCAT-1', 'ENCSR212VKB_AAACAGCCAGCACGTT-1', 'ENCSR212VKB_AAACATGCAATTAGCT-1', 'ENCSR212VKB_AAACATGCACCCTCAC-1', 'ENCSR212VKB_AAACATGCATAAGCAA-1', 'ENCSR212VKB_AAACATGCATAGCTTG-1']
[DEBUG] ATAC original_barcode examples: ['adrenal_gland_ENCSR212VKB_AAACAGCCAAAGGTAC-1', 'adrenal_gland_ENCSR212VKB_AAACAGCCAACAGGAT-1', 'adrenal_gland_ENCSR212VKB_AAACAGCCACAACAAA-1', 'adrenal_gland_ENCSR212VKB_AAACAGCCACATTGCA-1', 'adrenal_gland_ENCSR212VKB_AAACAGCCACCAGCAT-1', 'adrenal_gland_ENCSR212VKB_AAACAGCCAGCACGTT-1', 'adrenal_gland_ENCSR212VKB_AAACATGCAATTAGCT-1', 'adrenal_gland_ENCSR212VKB_AAACATGCACCCTCAC-1', 'adrenal_gland_ENCSR212VKB_AAACATGCATAAGCAA-1', 'adrenal_gland_ENCSR212VKB_AAACATGCATAGCTTG-1']
[debug] Using 'original_barcode' for pairing.
[debug] Wrote rna_barcodes_head.txt (n=100)
[debug] Wrote atac_barcodes_head.txt (n=100)

üîó Found 430595 paired cells
[debug] n_paired=430595
[debug] Wrote common_barcodes_head.txt (n=100)
   Subsampled to 43059 cells
[debug] Subsampled to 43059 cells
[debug] Wrote paired_indices_preview.csv

üîç Detecting data format...
   Data format: Sparse CSR matrix
   Estimated sparse matrix size: 38.70 GB
[debug] Sparse CSR detected; nnz‚âà1731517110

üìà Processing paired cells in batches...

‚úÖ Processed 43059 paired cells
   Computed 43059 cell correlations
[debug] n_processed=43059, n_cell_corr=43059

üìà Computing per-gene correlations (sampling)...
[debug] Sampling up to 1000 genes for per-gene correlation.

üé® Creating visualizations...

üíæ Saving results...
[debug] Saved summary_robust.csv and debug_context.json

================================================================================
SUMMARY
================================================================================
Paired cells: 43059
Processed cells: 43059
Cell correlations: 43059
Mean cell correlation: 0.5346
Mean gene correlation (sampled): 0.0244

Results saved to: /dcs07/hongkai/data/harry/result/all/validation_results_pseudorna
